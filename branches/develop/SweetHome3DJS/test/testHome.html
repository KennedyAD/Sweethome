<!--
   testHome.html 
   
   Sweet Home 3D, Copyright (c) 2016-2019 Emmanuel PUYBARET / eTeks <info@eteks.com>
   
   This program is free software; you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation; either version 2 of the License, or
   (at your option) any later version.
 
   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program; if not, write to the Free Software
   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>SweetHome3DJS Test</title>
<base href="..">
<script type="text/javascript" src="lib/big.min.js"></script>
<script type="text/javascript" src="lib/gl-matrix-min.js"></script>
<script type="text/javascript" src="lib/jszip.min.js"></script>
<script type="text/javascript" src="lib/jsXmlSaxParser.min.js"></script>
<script type="text/javascript" src="src/core.js"></script>
<script type="text/javascript" src="src/URLContent.js"></script>
<script type="text/javascript" src="src/scene3d.js"></script>
<script type="text/javascript" src="lib/generated/geom.js"></script>
<script type="text/javascript" src="lib/stroke.min.js"></script>
<!-- swingundo.js isn't required if SweetHome3D.js includes only viewer classes  -->
<script type="text/javascript" src="lib/generated/swingundo.js"></script>
<script type="text/javascript" src="lib/generated/batik-svgpathparser.js"></script>
<script type="text/javascript" src="lib/generated/SweetHome3D.js"></script>
<script type="text/javascript" src="src/HTMLCanvas3D.js"></script>
<script type="text/javascript" src="src/ShapeTools.js"></script>
<script type="text/javascript" src="src/ModelManager.js"></script>
<script type="text/javascript" src="src/ModelLoader.js"></script>
<script type="text/javascript" src="src/OBJLoader.js"></script>
<script type="text/javascript" src="src/Max3DSLoader.js"></script>
<script type="text/javascript" src="src/DAELoader.js"></script>
<script type="text/javascript" src="src/Triangulator.js"></script>
<script type="text/javascript" src="src/HomeRecorder.js"></script>
<script type="text/javascript" src="src/HomeComponent3D.js"></script>
<script type="text/javascript" src="src/Object3DBranch.js"></script>
<script type="text/javascript" src="src/HomePieceOfFurniture3D.js"></script>
<script type="text/javascript" src="src/Room3D.js"></script>
<script type="text/javascript" src="src/Wall3D.js"></script>
<script type="text/javascript" src="src/Ground3D.js"></script>
<script type="text/javascript" src="src/Polyline3D.js"></script>
<script type="text/javascript" src="src/Label3D.js"></script>
<script type="text/javascript" src="src/TextureManager.js"></script>
<script type="text/javascript" src="src/UserPreferences.js"></script>
<script type="text/javascript" src="src/LengthUnit.js"></script>
<script type="text/javascript" src="src/graphics2d.js"></script>
<script type="text/javascript" src="src/PlanComponent.js"></script>
</head>
<body>
<script type="text/javascript">
function assertEquals(message, expected, actual) {
  if (typeof expected === "number"
    	  && Math.abs(actual - expected) > 1E-5
      || typeof expected !== "number"
	       && expected != actual) {
    var report = message + ": " + actual + " not equal to " + expected;
    console.log(report);
    console.trace();
    //alert(report);
    throw new Error(report);
  }
}

function assertTrue(message, condition) {
  if (!condition) {
    console.log(message);
    console.trace();
    //alert(message);
    throw new Error(message);
  }
}

function fail(message) {
  throw new Error(message);
}

/**
 * Tests Javascript classes translated from OpenJDK classes found in java.awt.geom package.  
 */
function testGeom() {
  // Create a piece of furniture 
  var catalogPiece = new CatalogPieceOfFurniture("eTeks#Test", "Cube", null, null, [], null, null, 
      new URLContent("test/resources/cube.png"), null, new URLContent("test/resources/cube.zip"), 100, 100, 100, 0, 1, 
      true, null, null, false, "eTeks", true, true, true, null, null, null);
  var piece = new HomePieceOfFurniture(catalogPiece);
  assertEquals("Wrong name", "Cube", piece.getName());
  // Place it at center, rotate it of 45 deg
  piece.setX(0);
  piece.setY(0);
  piece.setAngle(Math.PI / 4);
  assertEquals("Wrong angle", Math.PI / 4, piece.getAngle());
  // Check first point
  assertEquals("Wrong point", 0, piece.getPoints() [0][0]);
  assertEquals("Wrong point", -50 * Math.sqrt(2), piece.getPoints() [0][1]);
  // Check perimeter
  var perimeter = 0;
  var piecePoints = piece.getPoints();
  for (var i = piecePoints.length - 1; i >= 0; i--) {
    perimeter += java.awt.geom.Point2D.distance(piecePoints [i == 0 ? piecePoints.length - 1 : i - 1][0], piecePoints [i == 0 ? piecePoints.length - 1 : i - 1][1], 
        piecePoints [i][0], piecePoints [i][1]);
  }
  assertEquals("Wrong perimeter", 400, perimeter);
  // Check distance between center and first line
  var distanceToCenter = java.awt.geom.Line2D.ptLineDist(piecePoints [0][0], piecePoints [0][1], piecePoints [1][0], piecePoints [1][1], piece.getX(), piece.getY());
  assertEquals("Wrong distance", 50, distanceToCenter);
  // Rotate and move piece and check again location and distances 
  piece.setAngle(-Math.PI / 3);
  piece.setX(100);
  piece.setY(300);
  piece.setWidthInPlan(50);
  piece.setDepthInPlan(20);
  piecePoints = piece.getPoints();
  assertEquals("Wrong point", 100 + 50 / 2 / 2 + 20 / 2 * Math.sqrt(3) / 2, piecePoints [2][0]);
  assertEquals("Wrong point", 300 - 50 / 2 * Math.sqrt(3) / 2 + 20 / 2 / 2, piecePoints [2][1]);
  perimeter = 0;
  for (var i = piecePoints.length - 1; i >= 0; i--) {
    perimeter += java.awt.geom.Point2D.distance(piecePoints [i == 0 ? piecePoints.length - 1 : i - 1][0], piecePoints [i == 0 ? piecePoints.length - 1 : i - 1][1], 
        piecePoints [i][0], piecePoints [i][1]);
  }
  assertEquals("Wrong perimeter", 50 * 2 + 20 * 2, perimeter);
  distanceToCenter = java.awt.geom.Line2D.ptLineDist(piecePoints [0][0], piecePoints [0][1], piecePoints [1][0], piecePoints [1][1], piece.getX(), piece.getY());
  assertEquals("Wrong distance", 10, distanceToCenter);
  distanceToCenter = java.awt.geom.Line2D.ptLineDist(piecePoints [2][0], piecePoints [2][1], piecePoints [1][0], piecePoints [1][1], piece.getX(), piece.getY());
  assertEquals("Wrong distance", 25, distanceToCenter);
  
  var area = new java.awt.geom.Area(new java.awt.geom.Rectangle2D.Double(50, -50, 300, 100));
  var rectangle = area.getBounds2D();
  
  // Create an area made of two overlapping rectangles 
  area = new java.awt.geom.Area();
  area.add(new java.awt.geom.Area(new java.awt.geom.Rectangle2D.Float(0, 0, 200, 100)));
  area.add(new java.awt.geom.Area(new java.awt.geom.Rectangle2D.Float(50, -50, 300, 100)));
  // Check area bounds
  var rectangle = area.getBounds2D();
  assertEquals("Wrong rectangle", 0, rectangle.getX());
  assertEquals("Wrong rectangle", -50, rectangle.getY());
  assertEquals("Wrong rectangle", 350, rectangle.getWidth());
  assertEquals("Wrong rectangle", 150, rectangle.getHeight());
  var pointCount = 0;
  var point = [0, 0];
  for (var pathIterator = area.getPathIterator(null); !pathIterator.isDone(); pathIterator.next()) {
    if (pathIterator.currentSegment(point) !== java.awt.geom.PathIterator.SEG_CLOSE) {
      // console.log(point [0] + "  " + point [1])
      pointCount++;
    }
  }
  assertEquals("Wrong point count", 8, pointCount); 
  
  // Test circle curve
  var polylinePath = new java.awt.geom.GeneralPath();
  var curvePoints = [[100, 0], [0, 100], [-100, 0], [0, -100]];
  for (var i = 0, n = curvePoints.length; i < n; i++) {
    var curve2D = new java.awt.geom.CubicCurve2D.Float();
    var previousPoint = curvePoints [i == 0 ?  curvePoints.length - 1  : i - 1];
    var point         = curvePoints [i];
    var nextPoint     = curvePoints [i == curvePoints.length - 1 ?  0  : i + 1];
    var vectorToBisectorPoint = [nextPoint [0] - previousPoint [0], nextPoint [1] - previousPoint [1]];
    var nextNextPoint     = curvePoints [(i + 2) % curvePoints.length];
    var vectorToBisectorNextPoint = [point[0] - nextNextPoint [0], point[1] - nextNextPoint [1]];
    curve2D.setCurve(point[0], point[1], 
        point [0] + vectorToBisectorPoint [0] / 3.625, 
        point [1] + vectorToBisectorPoint [1] / 3.625, 
        nextPoint [0] + vectorToBisectorNextPoint [0] / 3.625, 
        nextPoint [1] + vectorToBisectorNextPoint [1] / 3.625, 
        nextPoint [0], nextPoint [1]);
    polylinePath.append(curve2D, true);
  }
  area = new java.awt.geom.Area(polylinePath);
  // Check all points are at the right distance from center
  for (var pathIterator = area.getPathIterator(null, 0.1); !pathIterator.isDone(); pathIterator.next()) {
    if (pathIterator.currentSegment(point) !== java.awt.geom.PathIterator.SEG_CLOSE) {
      var distance = java.awt.geom.Point2D.distance(point [0], point [1], area.getBounds2D().getCenterX(), area.getBounds2D().getCenterY());
      assertTrue("Wrong distance " + distance, Math.abs(distance - 100) < 0.05);
    }
  }

  // Test Area substract
  var path = new java.awt.geom.GeneralPath();
  path.moveTo(494.6751772225669, 670.1);
  path.lineTo(5.901708600000002, 670.1);
  path.lineTo(5.9017086, 657.6);
  path.lineTo(505.9017600000001, 657.6);
  path.closePath();
  area = new java.awt.geom.Area(path);
  
  var path2 = new java.awt.geom.GeneralPath();
  path2.moveTo(232.060999211009, 670.1004180630736);
  path2.lineTo(100.06099921100918, 670.1004119369262);
  path2.lineTo(100.06100078899101, 636.0996619369263);
  path2.lineTo(232.06100078899087, 636.0996680630736);
  path2.closePath();
  area.subtract(new java.awt.geom.Area(path2));
  
  var getAreaPoints = function(area) {
    var points = [];
    for (var it = area.getPathIterator(null); !it.isDone(); it.next()) {
      var point = [0, 0];
      if (it.currentSegment(point) !== java.awt.geom.PathIterator.SEG_CLOSE) {
        points.push(point);
      }
    }
    return points;
  };

  var points = getAreaPoints(area);
  assertTrue("Wrong distance between points", Math.abs(points[2][0] - points[0][0]) < 100);
  
  // Test Area substract with slightly different values
  path = new java.awt.geom.GeneralPath();
  path.moveTo(Math.fround(494.6751772225669), Math.fround(670.1000000000004));
  path.lineTo(Math.fround(5.901708600000002), Math.fround(670.1));
  path.lineTo(Math.fround(5.9017086), Math.fround(657.6));
  path.lineTo(Math.fround(505.9017600000001), Math.fround(657.600000000000));
  path.closePath();
  var area2 = new java.awt.geom.Area(path);
  area2.subtract(new java.awt.geom.Area(path2));
  
  points = getAreaPoints(area2);
  assertTrue("Wrong distance between points", Math.abs(points[2][0] - points[0][0]) < 100);
  
  console.log("End of testGeom");	      
}

/**
 * Tests Home, HomeComponent3D and HomeController3D classes.
 */
function testHome(geomAvailable) {
  // Create a home with furniture
  var catalogPiece = new CatalogPieceOfFurniture("eTeks#Test", "Cube", "Test", null, ["Test"], null, 5, 
      new URLContent("test/resources/cube.png"), null, new URLContent("test/resources/cube.zip"), 100, 100, 100, 0, 1, 
      true, null, null, false, "eTeks", true, true, true, new Big("10.20"), new Big("20.6"), null);
  var home = new Home();
  var piece = new HomePieceOfFurniture(catalogPiece);
  home.addPieceOfFurniture(piece);
  piece = new HomePieceOfFurniture(catalogPiece);
  piece.setX(100);
  piece.setY(100);
  home.addPieceOfFurniture(piece);
  assertEquals("Wrong number of pieces", 2, home.getFurniture().length);
  home.deletePieceOfFurniture(piece);
  assertEquals("Wrong number of pieces", 1, home.getFurniture().length);
  var piece2 = new HomePieceOfFurniture(piece);
  piece2.setName("2");
  piece2.setX(200);
  piece2.setAngle(Math.PI / 4);
  var group = new HomeFurnitureGroup([piece, piece2], "Group");
  home.addPieceOfFurniture(group);
  assertEquals("Wrong number of pieces", 2, home.getFurniture().length);
  assertEquals("Wrong number of pieces in group", 2, group.getFurniture().length);
  if (geomAvailable) {
  	assertEquals("Wrong width", 150 + 50 * Math.sqrt(2), group.getWidth());
  }
  home.deletePieceOfFurniture(piece);
  assertEquals("Wrong number of pieces", 2, home.getFurniture().length);
  assertEquals("Wrong number of pieces in group", 1, group.getFurniture().length);
  // Add two walls
  var wall1 = new Wall(30, 725, 30, 870, 5, 150);
  var wall2 = new Wall(30, 870, 170, 870, 5, 150);
  wall1.setWallAtEnd(wall2);
  wall2.setWallAtStart(wall1);
  home.addWall(wall1);
  assertEquals("Wrong number of walls", 1, home.getWalls().length);
  var room = new Room([[30, 725], [30, 870], [170, 870], [160, 735]]);
  home.addRoom(room);
  assertEquals("Wrong number of rooms", 1, home.getRooms().length);
  var label = new Label("Date", 90, 900);
  label.setPitch(Math.PI / 3);
  label.setStyle(new TextStyle("Verdana", 30, true, false));
  label.setElevation(10);
  home.addLabel(label);
  assertEquals("Wrong number of labels", 1, home.getLabels().length);
  var polyline = new Polyline([[20, 910], [170, 910], [180, 890]]);
  polyline.setThickness(3);
  polyline.setDashPattern([10, 2]);  
  polyline.setVisibleIn3D(true);
  home.addPolyline(polyline);
  assertEquals("Wrong number of polylines", 1, home.getPolylines().length);
  
  new HomeRecorder().readHome("test/resources/HomeTest.sh3d", 
      {
	    homeLoaded: function(home) {
 	      assertTrue("No furniture", home.getFurniture().length > 0);
          var preferences = new DefaultUserPreferences();
	      displayHome(home, preferences);
		  // Add objects to home and make them blink	  
		  home.addPieceOfFurniture(piece);
		  piece.setX(-150);
		  piece.setY(250);
	      home.addWall(wall1);
	      home.addWall(wall2);
	      home.addRoom(room);
	      home.addLabel(label);
	      home.addPolyline(polyline);
		  var movedObjects = [wall1, wall2, room, label, polyline];
		  for (var i = 0; i < movedObjects.length; i++) {
		    movedObjects [i].move(-250, -550);
		  }
	      
	      // Create a group with smaller objects placed on top of piece
	      var piece3 = piece.clone();
	      piece3.setColor(0xFFFF0000);
	      var piece4 = piece.clone();
	      piece4.setColor(0xFF0000FF);
	      piece4.setElevation(piece3.getHeight());
	      piece4.setWidth(piece3.getWidth() / 2);
	      piece4.setDepth(piece3.getDepth() / 2);
	      piece4.setHeight(piece3.getHeight() / 2);
	      var group = new HomeFurnitureGroup([piece3, piece4], 0, false, "Group");
	      group.setElevation(piece.getHeight());
	      group.setWidth(group.getWidth() / 2);
	      group.setDepth(group.getDepth() / 2);
	      group.setHeight(group.getHeight() / 2);
	      group.setAngle(Math.PI / 4);
	      piece4.setPitch(Math.PI / 6);
	      piece4.setRoll(Math.PI / 6);
	      home.addPieceOfFurniture(group);
	      
	      var thicknessDelta = 0.5;
	      var lengthDelta = -5;
	      var elevationDelta = -5;
	      var dashOffsetDelta = 0.05;
	      setInterval(function() {
	          // Make piece blink
	          piece.setVisible(!piece.isVisible());
	          // Change wall and room color
	  	      wall2.setRightSideColor(wall2.getRightSideColor() == 0xFF00 ? 0xFFFFFF : 0xFF00);
	  	      room.setFloorColor(room.getFloorColor() == 0x77 ? 0x777777 : 0x77);
	  	      // Update label with current time
	  	      label.setText(new Date().toLocaleTimeString({hour: "numeric", minute: "numeric", second: "numeric"}))
	        }, 500);
	      setInterval(function() {
	          // Change objects location
	  	      wall1.setThickness(wall1.getThickness() + thicknessDelta);
	  	      if (wall1.getThickness() > 10 || wall1.getThickness() < 1) {
	  	        thicknessDelta = -thicknessDelta;
	  	      }
	  	      wall2.setXEnd(wall2.getXEnd() + lengthDelta);
	  	      if (wall2.getLength() >= 140 || wall2.getLength() < 20) {
	  	        lengthDelta = -lengthDelta;
	  	      }
	  	      label.setElevation(label.getElevation() + elevationDelta);
	  	      if (label.getElevation() >= 100 || label.getElevation() < 10) {
	  	        elevationDelta = -elevationDelta;
	  	      }
	  	      polyline.setDashOffset(polyline.getDashOffset() + dashOffsetDelta);
	  	      if (polyline.getDashOffset() >= 100 || polyline.getDashOffset() <= 0) {
	  	        dashOffsetDelta = -dashOffsetDelta;
	  	      }
	        }, 100);
	      
	      // View a clone of the home in the second canvas
	      visitHome(home.clone(), preferences);
	      displayPlan(home, preferences);
	      
	      console.log("End of testHome");	      
	    },
	    homeError: function(err) {
	      console.error(err);
	      //alert(err);
	    },
	    progression: function(part, info, percentage) {
	    }
	  });
}

function displayHome(home, preferences) {
  var controller = new HomeController3D(home, preferences);
  new HomeComponent3D("canvas3D", home, preferences, null, controller);
}

function visitHome(home, preferences) {
  home.setCamera(home.getObserverCamera());
  var controller = new HomeController3D(home, preferences);
  new HomeComponent3D("canvas3D_2", home, preferences, null, controller);
}

var plan;

function displayPlan(home, preferences) {
  preferences.setFurnitureViewedFromTop(true);
  plan = new PlanComponent("canvas2D", home, preferences, null, null);
  plan.setScale(0.75);
}

function testLocalization() {
  var preferences = new DefaultUserPreferences();
  preferences.setLanguage("en"); // Force English as default language
  assertEquals("Unexpected resource value", "License", preferences.getLocalizedString("HomePane", "libraries.libraryLicenseColumn"));
  assertEquals("Unexpected resource value", "A × B", preferences.getLocalizedString("CatalogItemToolTip", "tooltipTextureDimensions", ["A", "B"]));
  assertEquals("Unexpected resource value", "A × B", preferences.getLocalizedString("CatalogItemToolTip", "tooltipTextureDimensions", "A", "B"));
  assertEquals("Unexpected resource value", "1x2 pixels - 3 - 4 frames/second", preferences.getLocalizedString("VideoPanel", "videoFormatComboBox.format", [1, 2, 3, 4]));
  assertEquals("Unexpected resource value", "1x2 pixels - 3 - 4 frames/second", preferences.getLocalizedString("VideoPanel", "videoFormatComboBox.format", 1, 2, 3, 4));
  
  preferences.setLanguage("it");
  assertEquals("Unexpected resource value", "Licenza", preferences.getLocalizedString("HomePane", "libraries.libraryLicenseColumn"));
  preferences.setLanguage("zh");
  assertEquals("Unexpected resource value", "License", preferences.getLocalizedString("HomePane", "libraries.libraryLicenseColumn"));
  preferences.setLanguage("zh_CN");
  assertEquals("Unexpected resource value", "版权", preferences.getLocalizedString("HomePane", "libraries.libraryLicenseColumn"));
}

function testLengthUnit() {
  Locale.setDefault("en_US");
  assertEquals("Wrong conversion", "102", LengthUnit.CENTIMETER.getFormat().format(102));
  assertEquals("Wrong conversion", "1.02", LengthUnit.METER.getFormat().format(102));
  // \u00a0 is a no-break space
  assertEquals("Wrong conversion", "1,020", LengthUnit.MILLIMETER.getFormat().format(102));
  assertEquals("Wrong conversion", "102.2", LengthUnit.CENTIMETER.getFormat().format(102.23));
  assertEquals("Wrong conversion", "1.022", LengthUnit.METER.getFormat().format(102.23));
  assertEquals("Wrong conversion", "1.022", LengthUnit.METER.getFormat().format(102.2));
  assertEquals("Wrong conversion", "1.00", LengthUnit.METER.getFormat().format(100));

  assertEquals("Wrong conversion", "95 sq ft", LengthUnit.INCH.getAreaFormatWithUnit().format(87795.82347779837));
  
  Locale.setDefault("fr_FR");
  // Test formats without unit
  assertEquals("Wrong conversion", "102", LengthUnit.CENTIMETER.getFormat().format(102));
  assertEquals("Wrong conversion", "1,02", LengthUnit.METER.getFormat().format(102));
  // \u00a0 is a no-break space
  assertEquals("Wrong conversion", "1\u00a0020", LengthUnit.MILLIMETER.getFormat().format(102));
  
  assertEquals("Wrong conversion", "0'11\"",
      LengthUnit.INCH.getFormat().format(LengthUnit.inchToCentimeter(11)));
  assertEquals("Wrong conversion", "1'11\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(11 + 12)));
  assertEquals("Wrong conversion", "1'11\u215b\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(11 + 12 + 0.125)));
  assertEquals("Wrong conversion", "-1'11\u215b\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(-(11 + 12 + 0.125))));
  assertEquals("Wrong conversion", "-0'11\u215b\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(-(11 + 0.125))));
  assertEquals("Wrong conversion", "-0'0\u215b\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(-0.125)));
  assertEquals("Wrong conversion", "-1'",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(-12)));

  // Test formats with unit
  assertEquals("Wrong conversion", "102 cm", LengthUnit.CENTIMETER.getFormatWithUnit().format(102));
  assertEquals("Wrong conversion", "1,02 m", LengthUnit.METER.getFormatWithUnit().format(102));
  // \u00a0 is a no-break space
  assertEquals("Wrong conversion", "1\u00a0020 mm", LengthUnit.MILLIMETER.getFormatWithUnit().format(102));
  assertEquals("Wrong conversion", "0'11\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(11)));
  assertEquals("Wrong conversion", "1'11\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(11 + 12)));
  assertEquals("Wrong conversion", "1'11\u215b\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(11 + 12 + 0.125)));
  assertEquals("Wrong conversion", "0'2\u215b\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(2 + 0.13)));
  assertEquals("Wrong conversion", "1'0\u00bc\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(12 + 0.19)));
  assertEquals("Wrong conversion", "0'1\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(0.99)));
  assertEquals("Wrong conversion", "0'0\u215e\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(0.9)));
  assertEquals("Wrong conversion", "0'0\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(0.05)));

  assertEquals("Wrong conversion", "11\"",
      LengthUnit.INCH_DECIMALS.getFormatWithUnit().format(LengthUnit.inchToCentimeter(11)));
  assertEquals("Wrong conversion", "23\"",
      LengthUnit.INCH_DECIMALS.getFormatWithUnit().format(LengthUnit.inchToCentimeter(11 + 12)));
  assertEquals("Wrong conversion", "23,125\"",
      LengthUnit.INCH_DECIMALS.getFormatWithUnit().format(LengthUnit.inchToCentimeter(11 + 12 + 0.125)));
  assertEquals("Wrong conversion", "0,05\"",
      LengthUnit.INCH_DECIMALS.getFormatWithUnit().format(LengthUnit.inchToCentimeter(0.05)));
  
  assertEquals("Wrong conversion", "95 ft²", LengthUnit.INCH.getAreaFormatWithUnit().format(87795.82347779837));
  
  // Test parsing
//   assertEquals("Wrong parsing", 102, LengthUnit.CENTIMETER.getFormat().parseObject("102"));
//   assertEquals("Wrong parsing", 102, LengthUnit.METER.getFormat().parseObject("1,02"));
//   assertEquals("Wrong parsing", 102, LengthUnit.MILLIMETER.getFormat().parseObject("1020"));
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(0.125f),
//       ((Number)LengthUnit.INCH_DECIMALS.getFormat().parseObject("0,125")).floatValue(), 1E-10f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(0.125f),
//       ((Number)LengthUnit.INCH_DECIMALS.getFormat().parseObject("0,125\"")).floatValue(), 1E-10f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(11),
//       ((Number)LengthUnit.INCH.getFormat().parseObject("0'11\"")).floatValue(), 1E-10f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(10 + 12),
//       ((Number)LengthUnit.INCH.getFormat().parseObject("1 ' 10 \"")).floatValue(), 1E-10f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(24),
//       ((Number)LengthUnit.INCH.getFormat().parseObject("2'")).floatValue(), 1E-10f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(11),
//       ((Number)LengthUnit.INCH.getFormat().parseObject("11\"")).floatValue(), 1E-10f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(11),
//       ((Number)LengthUnit.INCH.getFormat().parseObject("11")).floatValue(), 1E-10f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(11.125f),
//       ((Number)LengthUnit.INCH.getFormat().parseObject("11,125")).floatValue(), 1E-10f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(12 + 11 + 3 * 0.125f),
//       ((Number)LengthUnit.INCH.getFormat().parseObject("1'11\u215c\"")).floatValue(), 1E-10f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(12 + 11 + 3 * 0.125f),
//       ((Number)LengthUnit.INCH.getFormat().parseObject("1'11 3/8\"")).floatValue(), 1E-10f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(12 + 11 + 3 * 0.125f),
//       ((Number)LengthUnit.INCH.getFormat().parseObject("1' 11 \u215c")).floatValue(), 1E-10f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(-(12 + 11 + 3 * 0.125f)),
//       ((Number)LengthUnit.INCH.getFormat().parseObject("-1' 11 \u215c")).floatValue(), 1E-10f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(-(12 + 11 + 3 * 0.125f)),
//       ((Number)LengthUnit.INCH.getFormat().parseObject("-1'11\u215c")).floatValue(), 1E-10f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(-(12 + 11 + 3 * 0.125f)),
//       ((Number)LengthUnit.INCH.getFormat().parseObject("-1'11 3/8")).floatValue(), 1E-10f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(-(12 + 3 * 0.125f)),
//       ((Number)LengthUnit.INCH.getFormat().parseObject("-1'0\u215c")).floatValue(), 1E-10f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(-(12 + 3 * 0.125f)),
//       ((Number)LengthUnit.INCH.getFormat().parseObject("-1'0 3/8")).floatValue(), 1E-10f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(-(11 + 3 * 0.125f)),
//       ((Number)LengthUnit.INCH.getFormat().parseObject("-0'11\u215c")).floatValue(), 1E-4f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(-(11 + 3 * 0.125f)),
//       ((Number)LengthUnit.INCH.getFormat().parseObject("-0'11 3/8")).floatValue(), 1E-4f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(-(3 * 0.125f)),
//       ((Number)LengthUnit.INCH.getFormat().parseObject("-0'0\u215c")).floatValue(), 1E-10f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(-(3 * 0.125f)),
//       ((Number)LengthUnit.INCH.getFormat().parseObject("-0' 0 \u215c\"")).floatValue(), 1E-10f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(-0.125f),
//       ((Number)LengthUnit.INCH.getFormat().parseObject("-0'0,125")).floatValue(), 1E-10f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  LengthUnit.inchToCentimeter(-0.125f),
//       ((Number)LengthUnit.INCH.getFormat().parseObject("-0,125")).floatValue(), 1E-10f);
//   TestUtilities.assertEqualsWithinEpsilon("Wrong conversion",  0,
//       ((Number)LengthUnit.INCH.getFormat().parseObject("-0'0")).floatValue(), 1E-10f);
//   try {
//     LengthUnit.INCH.getFormat().parseObject("'");
//     fail("' not a number");
//   } catch (error) {
//     // Expected a failure
//   }
//   try {
//     LengthUnit.INCH.getFormat().parseObject("\"");
//     fail("\" not a number");
//   } catch (error) {
//     // Expected a failure
//   }
//   try {
//     LengthUnit.INCH.getFormat().parseObject("10,2'");
//     fail("10,2' not a number"); // Accept fraction part only for inches
//   } catch (error) {
//     // Expected a failure
//   }
//   ParsePosition parsePosition = new ParsePosition(0);
//   LengthUnit.INCH.getFormat().parseObject("10A'", parsePosition);
//   assertEquals("Wrong parse position", "10A'".indexOf('A'), parsePosition.getIndex());
//   parsePosition = new ParsePosition(0);
//   LengthUnit.INCH.getFormat().parseObject("10'2A", parsePosition);
//   assertEquals("Wrong parse position", "10'2A".indexOf('A'), parsePosition.getIndex());
//   parsePosition = new ParsePosition(0);
//   LengthUnit.INCH.getFormat().parseObject("0,03/8", parsePosition);
//   assertEquals("Wrong parse position", "0,03/8".indexOf('/'), parsePosition.getIndex());
}


</script>

<canvas id="canvas3D" style="background-color: #CCCCCC; border: 1px solid gray;" 
		width="600" height="400" tabIndex="1"></canvas>
<canvas id="canvas2D" style="background-color: #FFFFFF; border: 1px solid gray;"         
		width="600" height="400" tabIndex="2"></canvas>
<canvas id="canvas3D_2" style="background-color: #CCCCCC; border: 1px solid gray;" 
		width="600" height="300" tabIndex="3"></canvas>

<script type="text/javascript">
testLocalization();
testLengthUnit();
var geomAvailable = typeof java.awt.geom.PathIterator !== "undefined";
if (geomAvailable) {
  testGeom();
}
testHome(geomAvailable);
</script>

</body>
</html>