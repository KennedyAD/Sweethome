<!--
   testHome.html 
   
   Sweet Home 3D, Copyright (c) 2016-2020 Emmanuel PUYBARET / eTeks <info@eteks.com>
   
   This program is free software; you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation; either version 2 of the License, or
   (at your option) any later version.
 
   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program; if not, write to the Free Software
   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-->
<!-- /!\ Requires lib files built with applicationLibraries Ant target 
         and access to local file system : https://www.google.com/search?q=browser+access+to+local+files -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
<meta name="format-detection" content="telephone=no">
<meta name="msapplication-tap-highlight" content="no">
<title>SweetHome3DJS Test</title>
<base href="..">
<script type="text/javascript" src="lib/big.min.js"></script>
<script type="text/javascript" src="lib/gl-matrix-min.js"></script>
<script type="text/javascript" src="lib/jszip.min.js"></script>
<script type="text/javascript" src="lib/jsXmlSaxParser.min.js"></script>

<script type="text/javascript" src="src/core.js"></script>
<script type="text/javascript" src="src/scene3d.js"></script>
<script type="text/javascript" src="src/HTMLCanvas3D.js"></script>
<script type="text/javascript" src="src/URLContent.js"></script>
<script type="text/javascript" src="src/ModelLoader.js"></script>
<script type="text/javascript" src="src/Triangulator.js"></script>
<script type="text/javascript" src="src/OBJLoader.js"></script>
<script type="text/javascript" src="src/DAELoader.js"></script>
<script type="text/javascript" src="src/Max3DSLoader.js"></script>
<script type="text/javascript" src="src/ModelManager.js"></script>
<script type="text/javascript" src="src/ModelPreviewComponent.js"></script>

<script type="text/javascript" src="lib/generated/geom.js"></script>
<script type="text/javascript" src="lib/stroke.min.js"></script>
<script type="text/javascript" src="lib/generated/swingundo.js"></script>
<script type="text/javascript" src="lib/generated/batik-svgpathparser.js"></script>
<script type="text/javascript" src="src/CoreTools.js"></script>
<script type="text/javascript" src="lib/generated/SweetHome3D.js"></script>
<script type="text/javascript" src="src/ShapeTools.js"></script>
<script type="text/javascript" src="src/HomeComponent3D.js"></script>
<script type="text/javascript" src="src/Object3DBranch.js"></script>
<script type="text/javascript" src="src/HomePieceOfFurniture3D.js"></script>
<script type="text/javascript" src="src/Room3D.js"></script>
<script type="text/javascript" src="src/Wall3D.js"></script>
<script type="text/javascript" src="src/Ground3D.js"></script>
<script type="text/javascript" src="src/Polyline3D.js"></script>
<script type="text/javascript" src="src/DimensionLine3D.js"></script>
<script type="text/javascript" src="src/Label3D.js"></script>
<script type="text/javascript" src="src/TextureManager.js"></script>
<script type="text/javascript" src="src/LengthUnit.js"></script>
<script type="text/javascript" src="src/UserPreferences.js"></script>
<script type="text/javascript" src="src/ContentDigestManager.js"></script>
<script type="text/javascript" src="src/HomeRecorder.js"></script>

<script type="text/javascript" src="src/graphics2d.js"></script>
<script type="text/javascript" src="src/ResourceAction.js"></script>
<script type="text/javascript" src="src/toolkit.js"></script>
<script type="text/javascript" src="src/PlanComponent.js"></script>
<script type="text/javascript" src="src/HomePane.js"></script>
<script type="text/javascript" src="src/DefaultFurnitureCatalog.js"></script>
<script type="text/javascript" src="src/DefaultTexturesCatalog.js"></script>
<script type="text/javascript" src="src/FurnitureCatalogListPanel.js"></script>
<script type="text/javascript" src="src/FurnitureTablePanel.js"></script>
<script type="text/javascript" src="src/ColorButton.js"></script>
<script type="text/javascript" src="src/TextureChoiceComponent.js"></script>
<script type="text/javascript" src="src/ModelMaterialsComponent.js"></script>
<script type="text/javascript" src="src/JSViewFactory.js"></script>
<script type="text/javascript" src="src/DirectHomeRecorder.js"></script>
<script type="text/javascript" src="src/IncrementalHomeRecorder.js"></script>
<script type="text/javascript" src="src/SweetHome3DJSApplication.js"></script>
<link rel="stylesheet" type="text/css" href="lib/sweethome3djs.css">
<style type="text/css">

html, body {
  overflow-x: hidden;
  overflow-y: hidden;
}

body {
  position: relative;
  margin: 0px;
  height: 100%;
  -ms-user-select: none;       
  user-select: none;    
  touch-action: none;
}

#home-plan::selection { background: #0042E0; }

#application-menu-toolbar, #home-pane-toolbar, 
#catalog-furniture-pane, #furniture-catalog, #catalog-furniture-splitter, #furniture-view, 
#furniture-plan-splitter, #plan-3D-view-pane, #home-plan, #plan-3D-view-splitter, #home-3D-view {
  position: absolute;
}

/*
 * No-touch devices common CSS
 */
#application-menu-toolbar {
  display: none;
}

#home-pane-toolbar {
  top: 0;
  height: 30px;
  white-space: nowrap;
}

#catalog-furniture-pane {
  top: 30px;
  left: 0;
  width: 296px;
  height: calc(100% - 30px);
  overflow: hidden;
}

#furniture-catalog {
  height: 70%;
  width: 100%;
  overflow-y: hidden;
}

#furniture-catalog-list {
  height: calc(100% - 3.3em);
  width: 100%;
  overflow-y: scroll;
}

#catalog-furniture-splitter {
  top: 70%;
  left: 0;
  width: 100%;
}

#furniture-view {
  top: calc(70% + 4px);
  width: 100%;
  height: calc(30% - 4px);
  box-sizing: border-box; 
}

#furniture-view .tree-table {
  width: 100%;
  height: 100%;
  overflow-y: hidden;
}

.pane-splitter.vertical::after {
  transform: rotate(90deg);
  bottom: initial;
  top: 50%;
}

#furniture-plan-splitter {
  top: 30px;
  left: 296px;
  height: calc(100% - 30px);
}

#plan-3D-view-pane {
  top: 30px;
  left: 300px;
  width: calc(100% - 300px);
  height: calc(100% - 30px);
}

#home-plan {
  width: 100%;
  height: calc(50% - 2px);
  font-family: sans-serif;
  border-top: 1px solid gray; 
  border-bottom: 1px solid gray; 
}

#plan-3D-view-splitter {
  top: calc(50% - 2px);
  left: 0;
  width: 100%;
}

#home-3D-view {
  top: calc(50% + 2px);
  width: 100%;
  height: calc(50% - 2px);
  border-bottom: 1px solid gray; 
}

#home-plan:focus, #home-3D-view:focus { 
  outline: none; 
}
  
@media (orientation: portrait) {

  #catalog-furniture-pane {
    width: 160px;
  }

  #furniture-plan-splitter {
    left: 160px;
  }

  #plan-3D-view-pane {
    left: 164px;
    width: calc(100% - 164px);
  }
}

/*
 * Touch devices common CSS - ignored by IE (coarse point query required for some Android devices)
 */
@media (hover: none), (pointer: coarse) {

  body {
    margin: 5px;
    height: calc(100% - 10px);
  }

  /* No scroll bars under Chrome */
  ::-webkit-scrollbar {
    display: none;
  }

  #application-menu-toolbar {
    display: flex;
    top: calc(100% - 40px);
    height: 40px;
    width: calc(28px + 15px);
  }
  
  #home-pane-toolbar {
    left: calc(28px + 20px);
    top: calc(100% - 40px);
    height: 40px;
    width: calc(100% - 28px - 20px);
  }

  @media (max-width: 940px) {
    #application-menu-toolbar {
      width: calc(28px + 11px);
    }
  
    #home-pane-toolbar {
      left: calc(28px + 13px);
      width: calc(100% - 28px - 13px);
    }
  }

  .toolbar .toolbar-button {
    margin-top: 0px;
    height: calc(100% - 2px);
  }

  #furniture-plan-splitter {
    width: 8px;
  }

  #catalog-furniture-splitter, #plan-3D-view-splitter {
    height: 8px;
  }
  
  #catalog-furniture-pane {
    top: 0;
    height: calc(100% - 42px);
  }
  
  #furniture-plan-splitter  {
    top: 0;
    height: calc(100% - 40px);
  }
  
  #plan-3D-view-pane {
    top: 0;
    height: calc(100% - 41px);
  }
  
  #catalog-furniture-pane {
    border-bottom: 1px solid gray;
  }
  
  #home-plan {
    width: calc(100% - 1px);
    height: calc(50% - 4px);
    border-right: 1px solid gray; 
  }
  
  #home-3D-view {
    top: calc(50% + 4px);
    width: calc(100% - 1px);
    height: calc(50% - 4px);
    border-right: 1px solid gray;
  }
  
  .popup-menu .item * {
    font-size: 17px;
  }
  
  .tree-table {
    font-size: 0.85em;
  }
  
  /* Small touch devices like smartphones */
  @media (max-width: 743px), (max-height: 511px) {
    .pane-splitter { 
      display: none; 
    } 
    
    #furniture-catalog {
      height: 100%;
    }
  
    #furniture-catalog-list {
      height: calc(100% - 2.5em);
      left: 0;
    }
  
    #catalog-furniture-splitter, #furniture-view {
      display: none;
    }
  
    #furniture-view {
      display: none;
    }
  
    @media (orientation: portrait), (max-aspect-ratio: 5/4) {
       #furniture-filter {
        height: 0px;
      }
      
  
      #plan-3D-view-pane {
        top: 0;
        left: 0;
        width: 100%;
        height: calc(100% - 80px - 40px);
      }
  
      #home-3D-view {
        top: 0;
        width: calc(100% - 2px);
        height: calc(50% - 2px - 4px);
        border: 1px solid gray; 
      }
  
      #plan-3D-view-splitter {
        display: initial;
        top: calc(50% - 4px);
        left: 0;
        width: calc(100%);
        height: 8px;
      }
  
      #home-plan {
        top: calc(50% - 1px + 4px);
        width: calc(100% - 2px);
        height: calc(50% - 4px);
        border: 1px solid gray;
      }
  
      /* Funiture catalog horizontal layout */
  
      #catalog-furniture-pane {
        top: calc(100% - 40px - 80px);
        left: 0;
        width: calc(100% - 2px);
        height: 79px;
        border-top: 0;
        overflow-x: scroll; 
        overflow-y: hidden; 
      }
  
      #furniture-catalog {
        width: 100%;
      }
  
      #furniture-catalog-list {
        width: 100%;
        height: 100%;
        overflow-x: scroll;
        overflow-y: hidden;
        white-space: nowrap;
      }
  
      .furniture-category-label {
        display: none;
      }
  
      .furniture {
        margin-top: 0px;
        margin-bottom: 0px;
        white-space: normal;
      }
      
      .furniture > .furniture-icon {
        top: 3px;
      }
  
      .furniture > .furniture-label {
        z-index: 2;
        text-shadow: white 0px -2px;
      }
  
      .furniture-category-separator {
        display: inline-block;
        height: 80px;
        padding-right: 10px;
        margin-right: 10px;
        border-right: dashed 1px rgba(0, 0, 0, 0.4);
      }
    }
  
    @media (orientation: landscape) and (min-aspect-ratio: 5/4) {
  
      #catalog-furniture-pane {
        top: 0;
        left: 0;
        width: 150px;
        height: calc(100% - 40px - 2px);
        overflow-x: hidden; 
        overflow-y: scroll; 
      }
  
      #plan-3D-view-pane {
        top: 0;
        left: 150px;
        width: calc(100% - 150px);
        height: calc(100% - 40px);
      }
  
      #home-plan {
        top: 0;
        width: calc(50% - 4px);
        height: calc(100% - 2px);
        border: 1px solid gray;
      }
  
      #plan-3D-view-splitter {
        display: initial;
        top: 0;
        left: calc(50% - 4px);
        width: 8px;
        height: calc(100%);
      }
  
      #home-3D-view {
        top: 0;
        left: calc(50%  + 4px);
        width: calc(50% - 4px);
        height: calc(100% - 2px);
        border: 1px solid gray; 
        border-left: 0px; 
      }
    }
  }
}

/* Hide optional buttons when screen is too small */
@media (max-width: 820px) {

  #home-pane-toolbar .toolbar-optional  {
    display: none;
  }
}

@media print {
  body * {
    visibility: hidden;
  }
  
  #home-plan canvas, #home-3D-view {
    visibility: visible; 
  	width: 100% !important;
   	height: auto !important;  
  }
  
  #plan-3D-view-pane {
  	top: 0 !important;
  	left: 0 !important;
  	width: 100% !important;
   	height: 100% !important;  
  }
}

</style>
</head>
<body>

<script type="text/javascript">
function assertEquals(message, expected, actual, showAlert) {
  if (typeof expected === "number"
          && Math.abs(actual - expected) > 1E-5
      || typeof expected !== "number"
           && expected != actual) {
    var report = message + ": " + actual + " not equal to " + expected;
    fail(report, showAlert);
  }
}

function assertTrue(message, condition, showAlert) {
  if (!condition) {
    fail(message, showAlert);
  }
}

function fail(message, showAlert) {
  if (showAlert === undefined) { showAlert = true; }
  if (showAlert) {
    alert(message);
  }
  throw new Error(message);
}

function testLocalization() {
  var preferences = new DefaultUserPreferences();
  preferences.setLanguage("en"); // Force English as default language
  assertEquals("Unexpected resource value", "License", preferences.getLocalizedString("HomePane", "libraries.libraryLicenseColumn"));
  assertEquals("Unexpected resource value", "A × B", preferences.getLocalizedString("CatalogItemToolTip", "tooltipTextureDimensions", ["A", "B"]));
  assertEquals("Unexpected resource value", "A × B", preferences.getLocalizedString("CatalogItemToolTip", "tooltipTextureDimensions", "A", "B"));
  assertEquals("Unexpected resource value", "1x2 pixels - 3 - 4 frames/second", preferences.getLocalizedString("VideoPanel", "videoFormatComboBox.format", [1, 2, 3, 4]));
  assertEquals("Unexpected resource value", "1x2 pixels - 3 - 4 frames/second", preferences.getLocalizedString("VideoPanel", "videoFormatComboBox.format", 1, 2, 3, 4));
  
  preferences.setLanguage("it");
  assertEquals("Unexpected resource value", "Licenza", preferences.getLocalizedString("HomePane", "libraries.libraryLicenseColumn"));
  preferences.setLanguage("zh");
  assertEquals("Unexpected resource value", "License", preferences.getLocalizedString("HomePane", "libraries.libraryLicenseColumn"));
  preferences.setLanguage("zh_CN");
  assertEquals("Unexpected resource value", "版权", preferences.getLocalizedString("HomePane", "libraries.libraryLicenseColumn"));
  
  console.log("End of testLocalization");          
}

function testLengthUnit() {
  Locale.setDefault("en_US");
  assertEquals("Wrong conversion", "102", LengthUnit.CENTIMETER.getFormat().format(102));
  assertEquals("Wrong conversion", "1.02", LengthUnit.METER.getFormat().format(102));
  assertEquals("Wrong conversion", "1,020", LengthUnit.MILLIMETER.getFormat().format(102));
  assertEquals("Wrong conversion", "1,023,456", LengthUnit.MILLIMETER.getFormat().format(102345.6));
  assertEquals("Wrong conversion", "-123,457", LengthUnit.MILLIMETER.getFormat().format(-12345.66));
  assertEquals("Wrong conversion", "102.2", LengthUnit.CENTIMETER.getFormat().format(102.23));
  assertEquals("Wrong conversion", "1.022", LengthUnit.METER.getFormat().format(102.23));
  assertEquals("Wrong conversion", "1.022", LengthUnit.METER.getFormat().format(102.2));
  assertEquals("Wrong conversion", "-1.022", LengthUnit.METER.getFormat().format(-102.2));
  assertEquals("Wrong conversion", "1.00", LengthUnit.METER.getFormat().format(100));
  assertEquals("Wrong conversion", "0.93", LengthUnit.METER.getFormat().format(93));
  assertEquals("Wrong conversion", "0.935", LengthUnit.METER.getFormat().format(93.489));
  assertEquals("Wrong conversion", "-0.934", LengthUnit.METER.getFormat().format(-93.449));
  assertEquals("Wrong conversion", "95 sq ft", LengthUnit.INCH.getAreaFormatWithUnit().format(87795.82347779837));
  var format = LengthUnit.MILLIMETER.getFormat().clone();
  format.setGroupingUsed(false);
  assertEquals("Wrong conversion", "1023456", format.format(102345.6));

  
  Locale.setDefault("fr_FR");
  // Test formats without unit
  assertEquals("Wrong conversion", "102", LengthUnit.CENTIMETER.getFormat().format(102));
  assertEquals("Wrong conversion", "1,02", LengthUnit.METER.getFormat().format(102));
  // \u00a0 is a no-break space
  assertEquals("Wrong conversion", "1\u00a0020", LengthUnit.MILLIMETER.getFormat().format(102));
  
  assertEquals("Wrong conversion", "0'11\"",
      LengthUnit.INCH.getFormat().format(LengthUnit.inchToCentimeter(11)));
  assertEquals("Wrong conversion", "1'11\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(11 + 12)));
  assertEquals("Wrong conversion", "1'11\u215b\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(11 + 12 + 0.125)));
  assertEquals("Wrong conversion", "-1'11\u215b\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(-(11 + 12 + 0.125))));
  assertEquals("Wrong conversion", "-0'11\u215b\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(-(11 + 0.125))));
  assertEquals("Wrong conversion", "-0'0\u215b\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(-0.125)));
  assertEquals("Wrong conversion", "-1'",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(-12)));
  assertEquals("Wrong conversion", "11\"",
      LengthUnit.INCH_FRACTION.getFormat().format(LengthUnit.inchToCentimeter(11)));
  assertEquals("Wrong conversion", "23\"",
      LengthUnit.INCH_FRACTION.getFormatWithUnit().format(LengthUnit.inchToCentimeter(11 + 12)));
  assertEquals("Wrong conversion", "23\u215b\"",
      LengthUnit.INCH_FRACTION.getFormatWithUnit().format(LengthUnit.inchToCentimeter(11 + 12 + 0.125)));
  assertEquals("Wrong conversion", "-23\u215b\"",
      LengthUnit.INCH_FRACTION.getFormatWithUnit().format(LengthUnit.inchToCentimeter(-(11 + 12 + 0.125))));
  assertEquals("Wrong conversion", "-11\u215b\"",
      LengthUnit.INCH_FRACTION.getFormatWithUnit().format(LengthUnit.inchToCentimeter(-(11 + 0.125))));
  assertEquals("Wrong conversion", "-0\u215b\"",
      LengthUnit.INCH_FRACTION.getFormatWithUnit().format(LengthUnit.inchToCentimeter(-0.125)));
  assertEquals("Wrong conversion", "-12\"",
      LengthUnit.INCH_FRACTION.getFormatWithUnit().format(LengthUnit.inchToCentimeter(-12)));
  assertEquals("Wrong conversion", "-12\"",
      LengthUnit.INCH_FRACTION.getFormatWithUnit().format(LengthUnit.inchToCentimeter(-12 - 0.05)));
  assertEquals("Wrong conversion", "-12\"",
      LengthUnit.INCH_FRACTION.getFormatWithUnit().format(LengthUnit.inchToCentimeter(-12 + 0.05)));

  // Test formats with unit
  assertEquals("Wrong conversion", "102 cm", LengthUnit.CENTIMETER.getFormatWithUnit().format(102));
  assertEquals("Wrong conversion", "1,02 m", LengthUnit.METER.getFormatWithUnit().format(102));
  // \u00a0 is a no-break space
  assertEquals("Wrong conversion", "1\u00a0020 mm", LengthUnit.MILLIMETER.getFormatWithUnit().format(102), false);
  assertEquals("Wrong conversion", "0'11\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(11)));
  assertEquals("Wrong conversion", "1'11\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(11 + 12)));
  assertEquals("Wrong conversion", "1'11\u215b\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(11 + 12 + 0.125)));
  assertEquals("Wrong conversion", "0'2\u215b\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(2 + 0.13)));
  assertEquals("Wrong conversion", "1'0\u00bc\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(12 + 0.19)));
  assertEquals("Wrong conversion", "0'1\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(0.99)));
  assertEquals("Wrong conversion", "0'0\u215e\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(0.9)));
  assertEquals("Wrong conversion", "0'0\"",
      LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.inchToCentimeter(0.05)));

  assertEquals("Wrong conversion", "1\u00a0200'",
          LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.footToCentimeter(1200)));
  assertEquals("Wrong conversion", "1\u00a0000'6\"",
          LengthUnit.INCH.getFormatWithUnit().format(LengthUnit.footToCentimeter(1000.5)));

  assertEquals("Wrong conversion", "11",
      LengthUnit.INCH_DECIMALS.getFormat().format(LengthUnit.inchToCentimeter(11)));
  assertEquals("Wrong conversion", "11\"",
      LengthUnit.INCH_DECIMALS.getFormatWithUnit().format(LengthUnit.inchToCentimeter(11)));
  assertEquals("Wrong conversion", "23\"",
      LengthUnit.INCH_DECIMALS.getFormatWithUnit().format(LengthUnit.inchToCentimeter(11 + 12)));
  assertEquals("Wrong conversion", "23,125\"",
      LengthUnit.INCH_DECIMALS.getFormatWithUnit().format(LengthUnit.inchToCentimeter(11 + 12 + 0.125)));
  assertEquals("Wrong conversion", "0,05\"",
      LengthUnit.INCH_DECIMALS.getFormatWithUnit().format(LengthUnit.inchToCentimeter(0.05)));
  assertEquals("Wrong conversion", "11",
      LengthUnit.FOOT_DECIMALS.getFormat().format(LengthUnit.footToCentimeter(11)));
  assertEquals("Wrong conversion", "11\'",
      LengthUnit.FOOT_DECIMALS.getFormatWithUnit().format(LengthUnit.footToCentimeter(11)));
  assertEquals("Wrong conversion", "23,125\'",
      LengthUnit.FOOT_DECIMALS.getFormatWithUnit().format(LengthUnit.footToCentimeter(11 + 12 + 0.125)));
  
  assertEquals("Wrong conversion", "95 ft²", LengthUnit.INCH.getAreaFormatWithUnit().format(87795.82347779837));
  
  // Test parsing
  assertEquals("Wrong parsing", 102, LengthUnit.CENTIMETER.getFormat().parseObject("102"));
  assertEquals("Wrong parsing", 102, LengthUnit.METER.getFormat().parseObject("1,02"));
  assertEquals("Wrong parsing", 102, LengthUnit.MILLIMETER.getFormat().parseObject("1020"));
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(0.125),
      LengthUnit.INCH_DECIMALS.getFormat().parseObject("0,125"), 1E-10);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(0.125),
      LengthUnit.INCH_DECIMALS.getFormat().parseObject("0,125\""), 1E-10);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(0.125),
      LengthUnit.FOOT_DECIMALS.getFormat().parseObject("0,0104167"), 1E-5);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(0.125),
      LengthUnit.FOOT_DECIMALS.getFormat().parseObject("0,0104167\'"), 1E-5);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(11),
      LengthUnit.INCH.getFormat().parseObject("0'11\""), 1E-10);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(10 + 12),
      LengthUnit.INCH.getFormat().parseObject("1 ' 10 \""), 1E-10);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(24),
      LengthUnit.INCH.getFormat().parseObject("2'"), 1E-10);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(11),
      LengthUnit.INCH.getFormat().parseObject("11\""), 1E-10);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(11),
      LengthUnit.INCH.getFormat().parseObject("11"), 1E-10);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(11.125),
      LengthUnit.INCH.getFormat().parseObject("11,125"), 1E-10);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(12 + 11 + 3 * 0.125),
      LengthUnit.INCH.getFormat().parseObject("1'11\u215c\""), 1E-10);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(12 + 11 + 3 * 0.125),
      LengthUnit.INCH.getFormat().parseObject("1'11 3/8\""), 1E-10);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(12 + 11 + 3 * 0.125),
      LengthUnit.INCH.getFormat().parseObject("1' 11 \u215c"), 1E-10);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(-(12 + 11 + 3 * 0.125)),
      LengthUnit.INCH.getFormat().parseObject("-1' 11 \u215c"), 1E-10);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(-(12 + 11 + 3 * 0.125)),
      LengthUnit.INCH.getFormat().parseObject("-1'11\u215c"), 1E-10);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(-(12 + 11 + 3 * 0.125)),
      LengthUnit.INCH.getFormat().parseObject("-1'11 3/8"), 1E-10);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(-(12 + 3 * 0.125)),
      LengthUnit.INCH.getFormat().parseObject("-1'0\u215c"), 1E-10);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(-(12 + 3 * 0.125)),
      LengthUnit.INCH.getFormat().parseObject("-1'0 3/8"), 1E-10);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(-(11 + 3 * 0.125)),
      LengthUnit.INCH.getFormat().parseObject("-0'11\u215c"), 1E-4);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(-(11 + 3 * 0.125)),
      LengthUnit.INCH.getFormat().parseObject("-0'11 3/8"), 1E-4);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(-(3 * 0.125)),
      LengthUnit.INCH.getFormat().parseObject("-0'0\u215c"), 1E-10);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(-(3 * 0.125)),
      LengthUnit.INCH.getFormat().parseObject("-0' 0 \u215c\""), 1E-10);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(-0.125),
      LengthUnit.INCH.getFormat().parseObject("-0'0,125"), 1E-10);
  assertEquals("Wrong conversion",  LengthUnit.inchToCentimeter(-0.125),
      LengthUnit.INCH.getFormat().parseObject("-0,125"), 1E-10);
  assertEquals("Wrong conversion",  0,
      LengthUnit.INCH.getFormat().parseObject("-0'0"), 1E-10);
  try {
    LengthUnit.INCH.getFormat().parseObject("'");
    fail("' not a number");
  } catch (ex) {
    // Expected a failure
  }
  try {
    LengthUnit.INCH.getFormat().parseObject("\"");
    fail("\" not a number");
  } catch (ex) {
    // Expected a failure
  }
  try {
    LengthUnit.INCH.getFormat().parseObject("10,2'");
    fail("10,2' not a number"); // Accept fraction part only for inches
  } catch (ex) {
    // Expected a failure
  }
  var parsePosition = new ParsePosition(0);
  LengthUnit.INCH.getFormat().parseObject("10A'", parsePosition);
  assertEquals("Wrong parse position", "10A'".indexOf('A'), parsePosition.getIndex());
  parsePosition = new ParsePosition(0);
  LengthUnit.INCH.getFormat().parseObject("10'2A", parsePosition);
  assertEquals("Wrong parse position", "10'2A".indexOf('A'), parsePosition.getIndex());
  parsePosition = new ParsePosition(0);
  LengthUnit.INCH.getFormat().parseObject("0,03/8", parsePosition);
  assertEquals("Wrong parse position", "0,03/8".indexOf('/'), parsePosition.getIndex());

  console.log("End of testLengthUnit");          
}

/**
 * Tests furniture catalog.  
 */
function testFurnitureCatalog() {
  Locale.setDefault("en_US");
  var preferences = new DefaultUserPreferences();
  var furnitureCatalog = preferences.getFurnitureCatalog();
  assertTrue("Wrong type of furniture catalog", furnitureCatalog instanceof DefaultFurnitureCatalog);
  assertTrue("Empty furniture catalog", furnitureCatalog.getCategories().length > 0);
  assertEquals("Unconsistant category count", furnitureCatalog.getCategoriesCount(), furnitureCatalog.getCategories().length);
  assertEquals("Wrong category", "Bathroom", furnitureCatalog.getCategories()[0].getName());
  assertEquals("Wrong furniture", "Bath", furnitureCatalog.getCategories()[0].getFurniture()[0].getName());
  
  preferences.setLanguage("fr");
  // TODO: shouldn't we reload the furniture catalog when language changes??
  preferences.setFurnitureCatalog(new DefaultFurnitureCatalog(preferences));
  furnitureCatalog = preferences.getFurnitureCatalog();
  assertEquals("Wrong category", "Chambre", furnitureCatalog.getCategories()[0].getName());
  assertEquals("Wrong furniture", "Armoire", furnitureCatalog.getCategories()[0].getFurniture()[0].getName());
  
  console.log("End of testFurnitureCatalog");          
}

/**
 * Tests Javascript classes translated from OpenJDK classes found in java.awt.geom package.  
 */
function testGeom() {
  // Create a piece of furniture 
  var catalogPiece = new CatalogPieceOfFurniture("eTeks#Test", "Cube", null, null, [], null, null, 
      new URLContent("test/resources/cube.png"), null, new URLContent("test/resources/cube.zip"), 100, 100, 100, 0, 1, 
      true, null, null, false, "eTeks", true, true, true, null, null, null);
  var piece = new HomePieceOfFurniture(catalogPiece);
  assertEquals("Wrong name", "Cube", piece.getName());
  // Place it at center, rotate it of 45 deg
  piece.setX(0);
  piece.setY(0);
  piece.setAngle(Math.PI / 4);
  assertEquals("Wrong angle", Math.PI / 4, piece.getAngle());
  // Check first point
  assertEquals("Wrong point", 0, piece.getPoints() [0][0]);
  assertEquals("Wrong point", -50 * Math.sqrt(2), piece.getPoints() [0][1]);
  // Check perimeter
  var perimeter = 0;
  var piecePoints = piece.getPoints();
  for (var i = piecePoints.length - 1; i >= 0; i--) {
    perimeter += java.awt.geom.Point2D.distance(piecePoints [i == 0 ? piecePoints.length - 1 : i - 1][0], piecePoints [i == 0 ? piecePoints.length - 1 : i - 1][1], 
        piecePoints [i][0], piecePoints [i][1]);
  }
  assertEquals("Wrong perimeter", 400, perimeter);
  // Check distance between center and first line
  var distanceToCenter = java.awt.geom.Line2D.ptLineDist(piecePoints [0][0], piecePoints [0][1], piecePoints [1][0], piecePoints [1][1], piece.getX(), piece.getY());
  assertEquals("Wrong distance", 50, distanceToCenter);
  // Rotate and move piece and check again location and distances 
  piece.setAngle(-Math.PI / 3);
  piece.setX(100);
  piece.setY(300);
  piece.setWidthInPlan(50);
  piece.setDepthInPlan(20);
  piecePoints = piece.getPoints();
  assertEquals("Wrong point", 100 + 50 / 2 / 2 + 20 / 2 * Math.sqrt(3) / 2, piecePoints [2][0]);
  assertEquals("Wrong point", 300 - 50 / 2 * Math.sqrt(3) / 2 + 20 / 2 / 2, piecePoints [2][1]);
  perimeter = 0;
  for (var i = piecePoints.length - 1; i >= 0; i--) {
    perimeter += java.awt.geom.Point2D.distance(piecePoints [i == 0 ? piecePoints.length - 1 : i - 1][0], piecePoints [i == 0 ? piecePoints.length - 1 : i - 1][1], 
        piecePoints [i][0], piecePoints [i][1]);
  }
  assertEquals("Wrong perimeter", 50 * 2 + 20 * 2, perimeter);
  distanceToCenter = java.awt.geom.Line2D.ptLineDist(piecePoints [0][0], piecePoints [0][1], piecePoints [1][0], piecePoints [1][1], piece.getX(), piece.getY());
  assertEquals("Wrong distance", 10, distanceToCenter);
  distanceToCenter = java.awt.geom.Line2D.ptLineDist(piecePoints [2][0], piecePoints [2][1], piecePoints [1][0], piecePoints [1][1], piece.getX(), piece.getY());
  assertEquals("Wrong distance", 25, distanceToCenter);
  
  var area = new java.awt.geom.Area(new java.awt.geom.Rectangle2D.Double(50, -50, 300, 100));
  var rectangle = area.getBounds2D();
  
  // Create an area made of two overlapping rectangles 
  area = new java.awt.geom.Area();
  area.add(new java.awt.geom.Area(new java.awt.geom.Rectangle2D.Float(0, 0, 200, 100)));
  area.add(new java.awt.geom.Area(new java.awt.geom.Rectangle2D.Float(50, -50, 300, 100)));
  // Check area bounds
  var rectangle = area.getBounds2D();
  assertEquals("Wrong rectangle", 0, rectangle.getX());
  assertEquals("Wrong rectangle", -50, rectangle.getY());
  assertEquals("Wrong rectangle", 350, rectangle.getWidth());
  assertEquals("Wrong rectangle", 150, rectangle.getHeight());
  var pointCount = 0;
  var point = [0, 0];
  for (var pathIterator = area.getPathIterator(null); !pathIterator.isDone(); pathIterator.next()) {
    if (pathIterator.currentSegment(point) !== java.awt.geom.PathIterator.SEG_CLOSE) {
      // console.log(point [0] + "  " + point [1])
      pointCount++;
    }
  }
  assertEquals("Wrong point count", 8, pointCount); 
  
  // Test circle curve
  var polylinePath = new java.awt.geom.GeneralPath();
  var curvePoints = [[100, 0], [0, 100], [-100, 0], [0, -100]];
  for (var i = 0, n = curvePoints.length; i < n; i++) {
    var curve2D = new java.awt.geom.CubicCurve2D.Float();
    var previousPoint = curvePoints [i == 0 ?  curvePoints.length - 1  : i - 1];
    var point         = curvePoints [i];
    var nextPoint     = curvePoints [i == curvePoints.length - 1 ?  0  : i + 1];
    var vectorToBisectorPoint = [nextPoint [0] - previousPoint [0], nextPoint [1] - previousPoint [1]];
    var nextNextPoint     = curvePoints [(i + 2) % curvePoints.length];
    var vectorToBisectorNextPoint = [point[0] - nextNextPoint [0], point[1] - nextNextPoint [1]];
    curve2D.setCurve(point[0], point[1], 
        point [0] + vectorToBisectorPoint [0] / 3.625, 
        point [1] + vectorToBisectorPoint [1] / 3.625, 
        nextPoint [0] + vectorToBisectorNextPoint [0] / 3.625, 
        nextPoint [1] + vectorToBisectorNextPoint [1] / 3.625, 
        nextPoint [0], nextPoint [1]);
    polylinePath.append(curve2D, true);
  }
  area = new java.awt.geom.Area(polylinePath);
  // Check all points are at the right distance from center
  for (var pathIterator = area.getPathIterator(null, 0.1); !pathIterator.isDone(); pathIterator.next()) {
    if (pathIterator.currentSegment(point) !== java.awt.geom.PathIterator.SEG_CLOSE) {
      var distance = java.awt.geom.Point2D.distance(point [0], point [1], area.getBounds2D().getCenterX(), area.getBounds2D().getCenterY());
      assertTrue("Wrong distance " + distance, Math.abs(distance - 100) < 0.05);
    }
  }

  // Test Area substract
  var path = new java.awt.geom.GeneralPath();
  path.moveTo(494.6751772225669, 670.1);
  path.lineTo(5.901708600000002, 670.1);
  path.lineTo(5.9017086, 657.6);
  path.lineTo(505.9017600000001, 657.6);
  path.closePath();
  area = new java.awt.geom.Area(path);
  
  var path2 = new java.awt.geom.GeneralPath();
  path2.moveTo(232.060999211009, 670.1004180630736);
  path2.lineTo(100.06099921100918, 670.1004119369262);
  path2.lineTo(100.06100078899101, 636.0996619369263);
  path2.lineTo(232.06100078899087, 636.0996680630736);
  path2.closePath();
  area.subtract(new java.awt.geom.Area(path2));
  
  var getAreaPoints = function(area) {
    var points = [];
    for (var it = area.getPathIterator(null); !it.isDone(); it.next()) {
      var point = [0, 0];
      if (it.currentSegment(point) !== java.awt.geom.PathIterator.SEG_CLOSE) {
        points.push(point);
      }
    }
    return points;
  };

  var points = getAreaPoints(area);
  assertTrue("Wrong distance between points", Math.abs(points[2][0] - points[0][0]) < 100);
  
  // Test Area substract with slightly different values
  path = new java.awt.geom.GeneralPath();
  path.moveTo(Math.fround(494.6751772225669), Math.fround(670.1000000000004));
  path.lineTo(Math.fround(5.901708600000002), Math.fround(670.1));
  path.lineTo(Math.fround(5.9017086), Math.fround(657.6));
  path.lineTo(Math.fround(505.9017600000001), Math.fround(657.600000000000));
  path.closePath();
  var area2 = new java.awt.geom.Area(path);
  area2.subtract(new java.awt.geom.Area(path2));
  
  points = getAreaPoints(area2);
  assertTrue("Wrong distance between points", Math.abs(points[2][0] - points[0][0]) < 100);
  
  console.log("End of testGeom");          
}

/**
 * Tests Home, HomeComponent3D and HomeController3D classes.
 */
function testHome() {
  // Create a home with furniture
  var catalogPiece = new CatalogPieceOfFurniture("eTeks#Test", "Cube", "Test", null, ["Test"], null, 5, 
      new URLContent("test/resources/cube.png"), null, new URLContent("test/resources/cube.zip"), 100, 100, 100, 0, 1, 
      true, null, null, false, "eTeks", true, true, true, new Big("10.20"), new Big("20.6"), null);
  var home = new Home();
  var piece = new HomePieceOfFurniture(catalogPiece);
  home.addPieceOfFurniture(piece);
  piece = new HomePieceOfFurniture(catalogPiece);
  piece.setX(100);
  piece.setY(100);
  piece.setProperty("prop1", "value1");
  piece.setProperty("prop2", "value2");
  assertEquals("Wrong number of properties", 2, piece.getPropertyNames().length);
  home.addPieceOfFurniture(piece);
  assertEquals("Wrong number of pieces", 2, home.getFurniture().length);
  home.deletePieceOfFurniture(piece);
  assertEquals("Wrong number of pieces", 1, home.getFurniture().length);
  var piece2 = new HomePieceOfFurniture(piece);
  piece2.setName("2");
  piece2.setX(200);
  piece2.setAngle(Math.PI / 4);
  var group = new HomeFurnitureGroup([piece, piece2], "Group");
  home.addPieceOfFurniture(group);
  assertEquals("Wrong number of pieces", 2, home.getFurniture().length);
  assertEquals("Wrong number of pieces in group", 2, group.getFurniture().length);
  assertEquals("Wrong width", 150 + 50 * Math.sqrt(2), group.getWidth());
  home.deletePieceOfFurniture(piece);
  assertEquals("Wrong number of pieces", 2, home.getFurniture().length);
  assertEquals("Wrong number of pieces in group", 1, group.getFurniture().length);
  // Add two walls
  var wall1 = new Wall(30, 725, 30, 870, 5, 150);
  var wall2 = new Wall(30, 870, 170, 870, 5, 150);
  wall1.setWallAtEnd(wall2);
  wall2.setWallAtStart(wall1);
  home.addWall(wall1);
  assertEquals("Wrong number of walls", 1, home.getWalls().length);
  var room = new Room([[30, 725], [30, 870], [170, 870], [160, 735]]);
  home.addRoom(room);
  assertEquals("Wrong number of rooms", 1, home.getRooms().length);
  var label = new Label("Date", 90, 900);
  label.setPitch(Math.PI / 3);
  label.setStyle(new TextStyle("Arial", 30, true, false));
  label.setElevation(10);
  home.addLabel(label);
  assertEquals("Wrong number of labels", 1, home.getLabels().length);
  var polyline = new Polyline([[20, 910], [170, 910], [180, 890]]);
  polyline.setThickness(3);
  polyline.setDashPattern([10, 2]);  
  polyline.setVisibleIn3D(true);
  home.addPolyline(polyline);
  assertEquals("Wrong number of polylines", 1, home.getPolylines().length);
  
  console.log("End of testHome");          
}

/**
 * Test modifications in the edited home.
 */
function testHomeModifications() {
  var home = application.getHomes() [0];
  var homeController = application.getHomeController(home);
  var planController = homeController.getPlanController();
  var planView = planController.getView();
  var secondPieceInFurnitureGroup = home.getFurniture() [0].getFurniture() [1];
  var xPiece = secondPieceInFurnitureGroup.getX();
  var yPiece = secondPieceInFurnitureGroup.getY();
  var firstPieceInCatalog = application.getUserPreferences().getFurnitureCatalog().getCategories() [0].getFurniture() [0];
  runActions([
    function() {
      planController.selectItem(home.getFurniture() [0]);
      assertTrue("First piece isn't a group", home.getSelectedItems() [0] instanceof HomeFurnitureGroup);
    },
    function() {
      planController.ungroupSelectedFurniture();
    },
    function() {
      planController.groupSelectedFurniture();
    },
    function() {
      homeController.undo();
      assertEquals("Selection wrong selection count", 3, home.getSelectedItems().length);
    },
    function() {
      homeController.undo();
      assertEquals("Selection wrong selection count", 1, home.getSelectedItems().length);
    },
    function() {
      homeController.redo();
    },
    function() {
      homeController.redo();
      assertEquals("Selection wrong selection count", 1, home.getSelectedItems().length);
      assertTrue("Group name visible", !home.getSelectedItems() [0].isNameVisible());
    },
    function() {
      // Undo again to keep group name visible
      homeController.undo();
    },
    function() {
      homeController.undo();
      assertTrue("Group name invisible", home.getSelectedItems() [0].isNameVisible());
    },
    function() {
      // Duplicate group without magnetism enabled
      planController.pressMouse(xPiece, yPiece, 1, false, false, true,
          application.getUserPreferences().isMagnetismEnabled());
      planController.moveMouse(xPiece + 200, yPiece + 200);
      planController.releaseMouse(xPiece + 200, yPiece + 200);
      assertTrue("First piece isn't a group", home.getSelectedItems() [0] instanceof HomeFurnitureGroup);
      assertEquals("Wrong X in original group", xPiece, secondPieceInFurnitureGroup.getX());
      assertEquals("Wrong Y in original group", yPiece, secondPieceInFurnitureGroup.getY());
      assertTrue("Wrong X in duplicate group", Math.abs(xPiece + 200 - home.getSelectedItems() [0].getFurniture() [1].getX()) < 0.01);
      assertTrue("Wrong Y in duplicate group", Math.abs(yPiece + 200 - home.getSelectedItems() [0].getFurniture() [1].getY()) < 0.01);
    },
    function() {
      var count = home.getFurniture().length;
      homeController.undo();
      assertEquals("Wrong furniture count", count - 1, home.getFurniture().length);
      assertTrue("Wrong item in selection", home.getSelectedItems() [0] instanceof HomeFurnitureGroup);
    },
    function() {
      // Select and move a piece
      planController.selectItem(home.getFurniture() [0].getFurniture() [1]);
    },
    function() {
      planController.pressMouse(xPiece, yPiece, 1, false, false);
      planController.moveMouse(xPiece - 10, yPiece - 10);
      planController.releaseMouse(xPiece - 10, yPiece - 10);
      assertEquals("Selection doesn't contain one piece", 1, home.getSelectedItems().length);
    },
    function() {
      // Add to selection a sibling piece
      planController.pressMouse(home.getFurniture() [0].getFurniture() [0].getX(), home.getFurniture() [0].getFurniture() [0].getY(), 1, true, false)
      planController.releaseMouse(home.getFurniture() [0].getFurniture() [0].getX(), home.getFurniture() [0].getFurniture() [0].getY())
    },
    function() {
      // Align them
      planController.alignSelectedFurnitureOnTop()
    },
    function() {
      homeController.undo();
    },
    function() {
      planController.alignSelectedFurnitureOnLeft()
    },
    function() {
      homeController.undo();
    },
    function() {
      planController.alignSelectedFurnitureSideBySide();
    },
    function() {
      homeController.undo();
    },
    function() {
      // Add to selection a third piece and distribute them
      planController.pressMouse(home.getFurniture() [0].getFurniture() [2].getX(), home.getFurniture() [0].getFurniture() [2].getY(), 1, true, false)
      planController.releaseMouse(home.getFurniture() [0].getFurniture() [2].getX(), home.getFurniture() [0].getFurniture() [2].getY())
    },
    function() {
      planController.distributeSelectedFurnitureHorizontally();
    },
    function() {
      // Change lead item in selection
      planController.pressMouse(home.getFurniture() [0].getFurniture() [1].getX(), home.getFurniture() [0].getFurniture() [1].getY(), 1, true, false)
      planController.releaseMouse(home.getFurniture() [0].getFurniture() [1].getX(), home.getFurniture() [0].getFurniture() [1].getY())
      planController.pressMouse(home.getFurniture() [0].getFurniture() [1].getX(), home.getFurniture() [0].getFurniture() [1].getY(), 1, true, false)
      planController.releaseMouse(home.getFurniture() [0].getFurniture() [1].getX(), home.getFurniture() [0].getFurniture() [1].getY())
    },
    function() {
      planController.alignSelectedFurnitureOnFrontSide();
      // Furniture should be located at the same place as in the original file
      assertTrue("Wrong X", Math.abs(xPiece - home.getSelectedItems()[2].getX()) < 0.01);
      assertTrue("Wrong Y", Math.abs(yPiece - home.getSelectedItems()[2].getY()) < 0.01);
    },
    function() {
      // Handle background image
      homeController.hideBackgroundImage();
    },
    function() {
      homeController.showBackgroundImage();
    },
    function() {
      homeController.deleteBackgroundImage();
      assertEquals("Background image still here", null, home.getBackgroundImage());
    },
    function() {
      homeController.undo();
    },
    function() {
      planController.lockBasePlan();
    },
    function() {
      planController.unlockBasePlan();
    },
    function() {
      homeController.undo();
      assertTrue("Base plan not locked", home.isBasePlanLocked());
    },
    function() {
      homeController.getFurnitureCatalogController().setSelectedFurniture([firstPieceInCatalog]);
    },
    function() {
      homeController.addHomeFurniture();
      assertEquals("Wrong id", home.getSelectedItems() [0].getCatalogId(), firstPieceInCatalog.getId());
    },
    function() {
      // Adding a piece not movable will unlock the plan automatically
      if (firstPieceInCatalog.isMovable()) {
        planController.unlockBasePlan();
      }
      assertTrue("Base plan still locked", !home.isBasePlanLocked());
    },
    function() {
      // Add another piece to selection
      planController.pressMouse(xPiece, yPiece, 1, true, false);
      planController.releaseMouse(xPiece, yPiece);
      assertEquals("Selection doesn't contain one piece", 2, home.getSelectedItems().length);
    },
    function() {
      planController.flipHorizontally();
    },
    function() {
      homeController.undo();
    },
    function() {
      planController.flipVertically();
    },
    function() {
      homeController.undo();
    },
    function() {
      planController.selectAll();
    },
    function() {
      planController.increaseTextSize();
    },
    function() {
      planController.decreaseTextSize();
    },
    function() {
      planController.toggleItalicStyle();
    },
    function() {
      planController.toggleBoldStyle();
    },
    function() {
      homeController.undo();
    },
    function() {
      homeController.undo();
    },
    function() {
      homeController.delete();
    },
    function() {
      homeController.undo();
    },
    function() {
      // Select and cut / paste new item to group
      planController.pressMouse(0, 0, 1, false, false);
      planController.releaseMouse(0, 0);
    },
    function() {
      homeController.getView().getActionMap() ['CUT'].actionPerformed();
    },
    function() {
      planController.selectItem(home.getFurniture() [0]);
    },
    function() {
      homeController.pasteToGroup();
      assertEquals("Wrong id", home.getSelectedItems() [0].getCatalogId(), firstPieceInCatalog.getId());
      assertEquals("Wrong item count", 4, home.getFurniture() [0].getFurniture().length);
    },
    function() {
      homeController.undo();
      assertEquals("Wrong item count", 3, home.getFurniture() [0].getFurniture().length);
    },
    function() {
      planController.addLevel();
      assertEquals("Wrong level count", 2, home.getLevels().length);
    },
    function() {
      // Paste item to new level
      homeController.getView().getActionMap() ['PASTE'].actionPerformed();
      assertEquals("Wrong level", home.getLevels() [1], home.getSelectedItems() [0].getLevel()); 
    },
    function() {
      // Drag and drop rotate indicator
      var indicatorLocation = home.getSelectedItems() [0].getPoints() [0];
      planView.makePointVisible(indicatorLocation [0] - 1, indicatorLocation [1] - 1);
    },
    function() {
      var piece = home.getSelectedItems() [0];
      var size = piece.getWidth();
      var indicatorLocation = piece.getPoints() [0];
      var angle = piece.getAngle();
      planController.moveMouse(indicatorLocation [0] - 1, indicatorLocation [1] - 1);
      planController.pressMouse(indicatorLocation [0] - 1, indicatorLocation [1] - 1, 1, false, false);
      planController.moveMouse(indicatorLocation [0] + size, indicatorLocation [1]);
      planController.releaseMouse(indicatorLocation [0] + size, indicatorLocation [1]);
      assertTrue("Angle didn't change", Math.abs(piece.getAngle() - angle) > 0.01);
    },
    function() {
      homeController.undo();
    },
    function() {
      // Drag and drop elevation indicator
      var indicatorLocation = home.getSelectedItems() [0].getPoints() [1];
      planView.makePointVisible(indicatorLocation [0] + 1, indicatorLocation [1] - 1);
    },
    function() {
      var piece = home.getSelectedItems() [0];
      var indicatorLocation = piece.getPoints() [1];
      var elevation = piece.getElevation();
      planController.moveMouse(indicatorLocation [0] + 1, indicatorLocation [1] - 1);
      planController.pressMouse(indicatorLocation [0] + 1, indicatorLocation [1] - 1, 1, false, false);
      planController.moveMouse(indicatorLocation [0] + 1, indicatorLocation [1] - 5);
      planController.releaseMouse(indicatorLocation [0] + 1, indicatorLocation [1] - 5);
      assertTrue("Elevation didn't change", piece.getElevation() > elevation);
    },
    function() {
      // Drag and drop resize indicator
      var indicatorLocation = home.getSelectedItems() [0].getPoints() [2];
      planView.makePointVisible(indicatorLocation [0] + 1, indicatorLocation [1] + 1);
    },
    function() {
      var piece = home.getSelectedItems() [0];
      var indicatorLocation = piece.getPoints() [2];
      var width = piece.getWidth();
      var depth = piece.getDepth();
      planController.moveMouse(indicatorLocation [0] + 1, indicatorLocation [1] + 1);
      planController.pressMouse(indicatorLocation [0] + 1, indicatorLocation [1] + 1, 1, false, false);
      planController.moveMouse(indicatorLocation [0] + 5, indicatorLocation [1] + 5);
      planController.releaseMouse(indicatorLocation [0] + 5, indicatorLocation [1] + 5);
      assertTrue("Width didn't change", piece.getWidth() > width);
      assertTrue("Depth didn't change", piece.getDepth() > depth);
    },
    function() {
      // Drag and drop height indicator
      var indicatorLocation = home.getSelectedItems() [0].getPoints() [3];
      planView.makePointVisible(indicatorLocation [0] - 1, indicatorLocation [1] + 1);
    },
    function() {
      var piece = home.getSelectedItems() [0];
      var indicatorLocation = piece.getPoints() [3];
      var height = piece.getHeight();
      planController.moveMouse(indicatorLocation [0] - 1, indicatorLocation [1] + 1);
      planController.pressMouse(indicatorLocation [0] - 1, indicatorLocation [1] + 1, 1, false, false);
      planController.moveMouse(indicatorLocation [0] - 1, indicatorLocation [1] - 3);
      planController.releaseMouse(indicatorLocation [0] - 1, indicatorLocation [1] - 3);
      assertTrue("Height didn't change", piece.getHeight() > height);
    },
    function() {
      homeController.undo();
    },
    function() {
      homeController.undo();
    },
    function() {
      homeController.undo();
    },
    function() {
      // Modify furniture
      var controller = new HomeFurnitureController(home, application.getUserPreferences(), null, null, homeController.getUndoableEditSupport());
      controller.setAngleInDegrees(45);
      controller.setPaint(HomeFurnitureController.FurniturePaint.COLORED);
      controller.setColor(0xFF770077);
      controller.setNameVisible(true);
      controller.setHorizontalAxis(HomeFurnitureController.FurnitureHorizontalAxis.PITCH);
      controller.setPitch(0.787);
      controller.setPrice(new Big("20.05"));
      application.getUserPreferences().setCurrency("EUR");
      controller.modifyFurniture();
      assertEquals("Wrong pitch", 0.787, home.getSelectedItems() [0].getPitch()); 
    },
    function() {
      // Drag and drop pitch indicator
      var indicatorLocation = home.getSelectedItems() [0].getPoints() [3];
      planView.makePointVisible(indicatorLocation [0] - 1, indicatorLocation [1] + 1);
    },
    function() {
      var piece = home.getSelectedItems() [0];
      var indicatorLocation = piece.getPoints() [3];
      var pitch = piece.getPitch();
      planController.moveMouse(indicatorLocation [0] - 1, indicatorLocation [1] + 1);
      planController.pressMouse(indicatorLocation [0] - 1, indicatorLocation [1] + 1, 1, false, false);
      planController.moveMouse(indicatorLocation [0] + 10, indicatorLocation [1] + 1);
      planController.releaseMouse(indicatorLocation [0] + 10, indicatorLocation [1] + 1);
      assertTrue("Pitch didn't change", Math.abs(piece.getPitch() - pitch) > 0.01);
    },
    function() {
      homeController.undo();
    },
    function() {
      // Copy to paste style later
      homeController.getView().getActionMap() ['COPY'].actionPerformed();
    },
    function() {
      homeController.undo();
      assertEquals("Wrong undone pitch", 0, home.getSelectedItems() [0].getPitch()); 
      assertEquals("Wrong undone color", null, home.getSelectedItems() [0].getColor()); 
    },
    function() {
      // Paste style
      homeController.pasteStyle();
      assertEquals("Wrong pasted color", 0xFF770077, home.getSelectedItems() [0].getColor()); 
    },
    function() {
      var piece = home.getSelectedItems() [0];
      planView.getHTMLElement().focus();
      homeController.delete();
      assertEquals("Selection not empty", 0, home.getSelectedItems().length); 
    },
    function() {
      // Draw 4 joined walls
      planController.setMode(PlanController.Mode.WALL_CREATION);
    },
    function() {
      planController.pressMouse(200, 0, 1, false, false);
      planController.moveMouse(200, 150);
      planController.releaseMouse(200, 150);
    },
    function() {
      planController.pressMouse(200, 150, 1, false, false);
      planController.releaseMouse(200, 150);
    },
    function() {
      planController.moveMouse(400, 150);
      planController.pressMouse(400, 150, 1, false, false);
      planController.releaseMouse(400, 150);
    },
    function() {
      planController.moveMouse(400, 0);
      planController.pressMouse(400, 0, 1, false, false);
      planController.releaseMouse(400, 0);
    },
    function() {
      planController.moveMouse(220, 0);
      planController.pressMouse(220, 0, 1, false, false);
      planController.releaseMouse(220, 0);
      planController.pressMouse(220, 0, 2, false, false);
      planController.releaseMouse(220, 0);
      assertEquals("Wrong walls count", 4, home.getSelectedItems().length); 
      assertTrue("Wrong type", home.getSelectedItems() [0] instanceof Wall); 
    },
    function() {
      homeController.undo();
    },
    function() {
      homeController.redo();
    },
    function() {
      planController.setMode(PlanController.Mode.SELECTION);
    },
    function() {
      planController.moveSelection(50, 50);
      assertEquals("Wrong wall X start", 250, home.getSelectedItems() [0].getXStart()); 
      assertEquals("Wrong wall Y start", 50, home.getSelectedItems() [0].getYStart()); 
    },
    function() {
      homeController.undo();
      assertEquals("Wrong wall X start", 200, home.getSelectedItems() [0].getXStart()); 
      assertEquals("Wrong wall Y start", 0, home.getSelectedItems() [0].getYStart()); 
    },
    function() {
      // Drag and drop wall size indicator
      var wall = home.getSelectedItems() [3];
      var wallXStart = wall.getXStart();
      var indicatorLocation = [wallXStart, wall.getYStart()];
      planController.moveMouse(indicatorLocation [0], indicatorLocation [1]);
      planController.pressMouse(indicatorLocation [0], indicatorLocation [1], 1, false, false);
      planController.moveMouse(indicatorLocation [0] - 3, indicatorLocation [1]);
      planController.releaseMouse(indicatorLocation [0] - 3, indicatorLocation [1]);
      assertTrue("Wrong wall X start", Math.abs(wall.getXStart() + 3 - wallXStart) < 0.01);
    },
    function() {
      homeController.undo();
    },
    function() {
      homeController.redo();
    },
    function() {
      // Modify walls
      var controller = new WallController(home, application.getUserPreferences(), null, null, homeController.getUndoableEditSupport());
      controller.setPattern(application.getUserPreferences().getPatternsCatalog().getPatterns() [3]);
      controller.setRightSideColor(0xFF770000);
      controller.modifyWalls();
      assertEquals("Wrong color", 0xFF770000, home.getSelectedItems() [0].getRightSideColor()); 
    },
    function() {
      homeController.undo();
      assertTrue("Wrong undone color", 0xFF770000 !== home.getSelectedItems() [0].getRightSideColor()); 
    },
    function() {
    },
    function() {
      planController.joinSelectedWalls();
    },
    function() {
      planController.reverseSelectedWallsDirection();
    },
    function() {
      // Select one wall and split it
      planController.pressMouse(300, 0, 1, false, false);
      planController.releaseMouse(300, 0);
    },
    function() {
      var length = home.getSelectedItems() [0].getLength();
      planController.splitSelectedWall();
      assertEquals("Wall not half smaller", length / 2, home.getSelectedItems() [0].getLength()); 
    },
    function() {
      var length = home.getSelectedItems() [0].getLength();
      homeController.undo();
      assertEquals("Wrong wall length", length * 2, home.getSelectedItems() [0].getLength());   
    },
    function() {
      // Drag and drop wall arc extent indicator
      var wall = home.getSelectedItems() [0];
      var wallArcExtent = wall.getArcExtent();
      var wallLength = wall.getLength();
      var indicatorLocation = [(wall.getXStart() + wall.getXEnd()) / 2, (wall.getYStart() + wall.getYEnd()) / 2];
      planController.moveMouse(indicatorLocation [0], indicatorLocation [1]);
      planController.pressMouse(indicatorLocation [0], indicatorLocation [1], 1, false, false);
      planController.moveMouse(indicatorLocation [0], indicatorLocation [1] - wallLength / 2);
      planController.releaseMouse(indicatorLocation [0], indicatorLocation [1] - wallLength / 2);
      assertTrue("Wrong wall arc extent", Math.abs(wall.getArcExtent() - Math.PI) < 0.01);
    },
    function() {
      homeController.undo();
    },
    function() {
      homeController.redo();
    },
    function() {
      // Draw a room by double clicking within walls
      planController.setMode(PlanController.Mode.ROOM_CREATION);
    },
    function() {
      planController.pressMouse(250, 100, 1, false, false);
      planController.releaseMouse(250, 100);
      planController.pressMouse(250, 100, 2, false, false);
      planController.releaseMouse(250, 100);
      assertEquals("Wrong room count", 1, home.getSelectedItems().length); 
      assertTrue("Wrong type", home.getSelectedItems() [0] instanceof Room); 
    },
    function() {
      homeController.undo();
    },
    function() {
      homeController.redo();
    },
    function() {
      planController.setMode(PlanController.Mode.SELECTION);
    },
    function() {
      // Add a point to room
      var room = home.getSelectedItems() [0];
      var roomPoints = room.getPoints();
      var count = roomPoints.length;
      var newPoint = roomPoints [0][0] === roomPoints [1][0]
          ? [roomPoints [0][0], (roomPoints [0][1] + roomPoints [1][1]) / 2]
          : [(roomPoints [0][0] + roomPoints [1][0]) / 2, roomPoints [0][1]];
      planController.addPointToSelectedRoom(newPoint [0], newPoint [1]);
      assertEquals("Wrong room points count", count + 1, room.getPoints().length); 
    },
    function() {
      var room = home.getSelectedItems() [0];
      var count = room.getPoints().length;
      homeController.undo();
      assertEquals("Wrong room points count", count - 1, room.getPoints().length);   
    },
    function() {
      homeController.redo();
    },
    function() {
      // Delete point from room
      var room = home.getSelectedItems() [0];
      var roomPoints = room.getPoints();
      var count = roomPoints.length;
      planController.deletePointFromSelectedRoom(roomPoints [1][0], roomPoints [1][1]);
      assertEquals("Wrong room points count", count - 1, room.getPoints().length); 
    },
    function() {
      // Move first point of room without magnetism enabled
      var room = home.getSelectedItems() [0];
      var indicatorLocation = room.getPoints() [0];
      planController.moveMouse(indicatorLocation [0], indicatorLocation [1]);
      planController.pressMouse(indicatorLocation [0], indicatorLocation [1], 1, false, false, false,
          application.getUserPreferences().isMagnetismEnabled());
      planController.moveMouse(indicatorLocation [0] - 10, indicatorLocation [1]  - 10);
      planController.releaseMouse(indicatorLocation [0] - 10, indicatorLocation [1]  - 10);
      assertTrue("Wrong room point", Math.abs(room.getPoints() [0][0] + 10 - indicatorLocation[0]) < 0.01); 
      assertTrue("Wrong room point", Math.abs(room.getPoints() [0][1] + 10 - indicatorLocation[1]) < 0.01); 
    },
    function() {
      homeController.undo();
    },
    function() {
      // Modify rooms
      var controller = new RoomController(home, application.getUserPreferences(), null, null, homeController.getUndoableEditSupport());
      controller.setFloorPaint(RoomController.RoomPaint.COLORED);
      controller.setFloorColor(0xFF444477);
      controller.getWallSidesBaseboardController().setVisible(true);
      controller.getWallSidesBaseboardController().setColor(0xFF000044);
      controller.modifyRooms();
      assertEquals("Wrong color", 0xFF444477, home.getSelectedItems() [0].getFloorColor()); 
    },
    function() {
      homeController.undo();
      assertTrue("Wrong undone color", 0xFF444477 !== home.getSelectedItems() [0].getFloorColor()); 
    },
    function() {
      // Draw a round polygon
      planController.setMode(PlanController.Mode.POLYLINE_CREATION);
    },
    function() {
      planController.pressMouse(0, 100, 1, false, false);
      planController.moveMouse(0, 140);
      planController.releaseMouse(0, 140);
    },
    function() {
      planController.pressMouse(0, 140, 1, false, false);
      planController.releaseMouse(0, 140);
    },
    function() {
      planController.moveMouse(40, 140);
      planController.pressMouse(40, 140, 1, false, false);
      planController.releaseMouse(40, 140);
    },
    function() {
      planController.moveMouse(40, 100);
      planController.pressMouse(40, 0, 1, false, false);
      planController.releaseMouse(40, 100);
    },
    function() {
      planController.moveMouse(0, 100);
      planController.pressMouse(0, 100, 1, false, false);
      planController.releaseMouse(0, 100);
      planController.pressMouse(0, 100, 2, false, false);
      planController.releaseMouse(0, 100);
      assertEquals("Wrong polyline count", 1, home.getSelectedItems().length); 
      assertTrue("Wrong type", home.getSelectedItems() [0] instanceof Polyline); 
    },
    function() {
      planController.setMode(PlanController.Mode.SELECTION);
    },
    function() {
      // Modify polylines
      var controller = new PolylineController(home, application.getUserPreferences(), null, null, homeController.getUndoableEditSupport());
      controller.setJoinStyle(Polyline.JoinStyle.CURVED);
      controller.setColor(0xFF007700);
      controller.setElevation(10);
      controller.modifyPolylines();
      assertEquals("Wrong elevation", 10, home.getSelectedItems() [0].getElevation()); 
    },
    function() {
      homeController.undo();
      assertEquals("Wrong undone elevation", 0, home.getSelectedItems() [0].getElevation()); 
    },
    function() {
      // Move first point of polyline without magnetism enabled
      var polyline = home.getSelectedItems() [0];
      var indicatorLocation = polyline.getPoints() [0];
      planController.moveMouse(indicatorLocation [0], indicatorLocation [1]);
      planController.pressMouse(indicatorLocation [0], indicatorLocation [1], 1, false, false, false,
          application.getUserPreferences().isMagnetismEnabled());
      planController.moveMouse(indicatorLocation [0] - 10, indicatorLocation [1]);
      planController.releaseMouse(indicatorLocation [0] - 10, indicatorLocation [1]);
      assertTrue("Wrong polyline point", Math.abs(polyline.getPoints() [0][0] + 10 - indicatorLocation[0]) < 0.01); 
    },
    function() {
      homeController.undo();
    },
    function() {
      // Draw a dimension line
      planController.setMode(PlanController.Mode.DIMENSION_LINE_CREATION);
    },
    function() {
      // Double click along last wall
      var walls = home.getWalls();
      var wallPoints = walls [walls.length - 3].getPoints();
      var xMiddle = (wallPoints [0][0] + wallPoints [1][0]) / 2;
      planController.moveMouse(xMiddle, wallPoints [0][1]);
      planController.pressMouse(xMiddle, wallPoints [0][1], 1, false, false);
      planController.releaseMouse(xMiddle, wallPoints [0][1]);
      planController.pressMouse(xMiddle, wallPoints [0][1], 2, false, false);
      planController.releaseMouse(xMiddle, wallPoints [0][1]);
    },
    function() {
      var walls = home.getWalls();
      var wallPoints = walls [walls.length - 3].getPoints();
      var xMiddle = (wallPoints [0][0] + wallPoints [1][0]) / 2;
      // Move offset
      planController.moveMouse(xMiddle, wallPoints [0][1] + 20);
      planController.pressMouse(xMiddle, wallPoints [0][1] + 20, 1, false, false);
      planController.releaseMouse(xMiddle, wallPoints [0][1] + 20);
      assertEquals("Wrong dimension line count", 1, home.getSelectedItems().length); 
      assertTrue("Wrong type", home.getSelectedItems() [0] instanceof DimensionLine); 
    },
    function() {
      planController.setMode(PlanController.Mode.SELECTION);
    },
    function() {
      // Drag and drop dimension line size indicator
      var dimensionLine = home.getSelectedItems() [0];
      var dimensionLineXEnd = dimensionLine.getXEnd();
      var indicatorLocation = [dimensionLineXEnd, dimensionLine.getYEnd()];
      planController.moveMouse(indicatorLocation [0], indicatorLocation [1]);
      planController.pressMouse(indicatorLocation [0], indicatorLocation [1], 1, false, false);
      planController.moveMouse(indicatorLocation [0] + 20, indicatorLocation [1]);
      planController.releaseMouse(indicatorLocation [0] + 20, indicatorLocation [1]);
      assertTrue("Dimension line X end didn't change", dimensionLine.getXEnd() > dimensionLineXEnd);
    },
    function() {
      // Add a text
      planController.setMode(PlanController.Mode.LABEL_CREATION);
    },
    function() {
      var controller = new LabelController(home, 100, 200, application.getUserPreferences(), null, homeController.getUndoableEditSupport());
      controller.setText("Hello");
      controller.setElevation(5);
      controller.createLabel();
      assertEquals("Wrong label count", 1, home.getSelectedItems().length); 
      assertTrue("Wrong type", home.getSelectedItems() [0] instanceof Label); 
    },
    function() {
      planController.setMode(PlanController.Mode.SELECTION);
      // Modify labels
      var controller = new LabelController(home, application.getUserPreferences(), null, homeController.getUndoableEditSupport());
      controller.setFontSize(30);
      controller.modifyLabels();
      assertEquals("Wrong font size", 30, home.getSelectedItems() [0].getStyle().getFontSize()); 
    },
    function() {
      homeController.undo();
      assertEquals("Wrong undone font size", 18, home.getSelectedItems() [0].getStyle().getFontSize()); 
    },
    function() {
      // Modify level
      var controller = new LevelController(home, application.getUserPreferences(), null, homeController.getUndoableEditSupport());
      controller.setElevation(150);
      controller.setFloorThickness(50);
      controller.modifyLevels();
      assertEquals("Wrong elevation", 150, home.getSelectedLevel().getElevation()); 
    },
    function() {
      homeController.undo();
      assertEquals("Wrong elevation", application.getUserPreferences().getNewWallHeight() + application.getUserPreferences().getNewFloorThickness(), home.getSelectedLevel().getElevation()); 
    },
    function() {
      // Modify 3D view
      var controller = new Home3DAttributesController(home, application.getUserPreferences(), null, null, homeController.getUndoableEditSupport());
      controller.setGroundColor(0xFF333333);
      controller.setGroundPaint(Home3DAttributesController.EnvironmentPaint.COLORED);
      controller.setWallsAlpha(0.5);
      controller.setBackgroundImageVisibleOnGround3D(false);
      controller.modify3DAttributes();
      assertEquals("Wrong walls alpha", 0.5, home.getEnvironment().getWallsAlpha()); 
    },
    function() {
      homeController.undo();
      assertEquals("Wrong undone walls alpha", 0, home.getEnvironment().getWallsAlpha()); 
    },
    function() {
      // Store a point of view
      homeController.getHomeController3D().storeCamera("Test");
      assertEquals("Home wrong stored camera count", 2, home.getStoredCameras().length); 
    },
    function() {
      // Change camera
      var camera = home.getCamera();
      if (camera === home.getTopCamera()) {
        homeController.getHomeController3D().viewFromObserver();  
      } else {
        homeController.getHomeController3D().viewFromTop();
      }
      assertTrue("No camera change", home.getCamera() !== camera); 
    },
    function() {
      planController.selectItem(home.getCompass());
      planView.makeSelectionVisible();
    },
    function() {
      // Modify compass
      var controller = new CompassController(home, application.getUserPreferences(), null, homeController.getUndoableEditSupport());
      controller.setDiameter(100);
      controller.setNorthDirectionInDegrees(0);
      controller.modifyCompass();
      assertEquals("Wrong compass diameter", 100, home.getCompass().getDiameter()); 
    },
    function() {
      homeController.undo();
      assertEquals("Wrong undone diameter", 62, home.getCompass().getDiameter()); 
    },
    function() {
      // Drag and drop compass size indicator
      var compass = home.getSelectedItems() [0];
      var diameter = compass.getDiameter();
      var compassPoints = compass.getPoints();
      var indicatorLocation = [(compassPoints [1][0] + compassPoints [2][0]) / 2,
                               (compassPoints [1][1] + compassPoints [2][1]) / 2];
      planController.moveMouse(indicatorLocation [0] + 0.01, indicatorLocation [1]);
      planController.pressMouse(indicatorLocation [0] + 0.01, indicatorLocation [1], 1, false, false);
      planController.moveMouse(indicatorLocation [0] + 20, indicatorLocation [1]);
      planController.releaseMouse(indicatorLocation [0] + 20, indicatorLocation [1]);
      assertTrue("Compass size didn't change", compass.getDiameter() > diameter);
    },
    function() {
      homeController.undo();
      assertEquals("Wrong undone diameter", 62, home.getCompass().getDiameter()); 
    },
    function() {
      planController.toggleSelectedLevelViewability();
      assertEquals("Wrong level count", 2, home.getLevels().length); 
      assertTrue("Wrong level viewability", !home.getLevels() [1].isViewable()); 
    },
    function() {
      homeController.undo();
      assertTrue("Wrong level viewability", home.getLevels() [1].isViewable()); 
    },
    function() {
      planController.deleteSelectedLevel();
      assertEquals("Wrong level count", 1, home.getLevels().length); 
    },
    function() {
      homeController.undo();
      assertEquals("Wrong level count", 2, home.getLevels().length);
    },
    function() {
      homeController.redo();
      console.log("End of testHomeModifications");       
    }
    ], 0); // End of actions to run
}

function runActions(actions, index) {
  // Run each action in a setTimeout to ensure setTimeout calls in launched actions are run too 
  if (index < actions.length) {
    actions [index]();
    setTimeout(function() {
        runActions(actions, index + 1);
    });
  }
}

// Run unit tests
testLocalization();
testLengthUnit();
testFurnitureCatalog();
testGeom();
testHome();
</script>

<!--  HTML Elements of the user interface -->
<div id="home-pane">
  <div id="application-menu-toolbar" class="toolbar"></div><div id="home-pane-toolbar" class="toolbar new-home open save save-as"></div>

  <div id="catalog-furniture-pane">
    <div id="furniture-catalog" tabindex="-1"><div id="furniture-catalog-list" class="furniture-catalog-list"></div></div>
    <div id="catalog-furniture-splitter" class="pane-splitter"></div>
    <div id="furniture-view" tabindex="-1"></div>
  </div>
  
  <div id="furniture-plan-splitter" class="pane-splitter"></div>
  
  <div id="plan-3D-view-pane">
    <div id="home-plan" style="background-color: #FFFFFF; color: #000000;" tabindex="1" ><select id="level-selector"></select></div>
    <div id="plan-3D-view-splitter" class="pane-splitter"></div>
    <canvas id="home-3D-view" style="background-color: #CCCCCC;" tabindex="2"></canvas>
  </div>
</div>

<div id="home-furniture-dialog-template" class="dialog-template">
  <div class="home-furniture-dialog">
    <h3 class="card" data-name="name-and-price-title"></h3>
    <div data-name="name-and-price-panel" class="card label-input-grid">
      <div class="label-cell">
        <div data-name="name-label">@{HomeFurniturePanel.nameLabel.text}</div>
      </div>
      <div>
        <input name="name-input" size="50" type="text" />

        <label>
          <input type="checkbox" name="name-visible-checkbox" />
          <span>@{HomeFurniturePanel.nameVisibleCheckBox.text}</span>
        </label>
      </div>

      <div class="label-cell">
        <div data-name="description-label">@{HomeFurniturePanel.descriptionLabel.text}</div>
      </div>
      <div>
        <input name="description-input" size="50" type="text" />
      </div>
      
      <div class="label-cell">
        <div data-name="price-label">@{HomeFurniturePanel.priceLabel.text}</div>
      </div>
      <div>
        <span data-name="price-input"></span>

        <span>@{HomeFurniturePanel.valueAddedTaxPercentageLabel.text}</span>
        <span data-name="value-added-tax-percentage-input"></span>
      </div>
    </div>

    <br />
    <div class="columns">
      <div class="location-column">
        <h3 class="card">@{HomeFurniturePanel.locationPanel.title}</h3>
        <div class="location-panel card label-input-grid">
          <div data-name="x-label" class="label-cell"></div>
          <div>
            <span data-name="x-input"></span>
          </div>

          <div data-name="y-label" class="label-cell"></div>
          <div>
            <span data-name="y-input"></span>
          </div>

          <div data-name="elevation-label" class="label-cell"></div>
          <div>
            <span data-name="elevation-input"></span>
          </div>

          <label title="@{HomeFurniturePanel.mirroredModelCheckBox.tooltip}" class="whole-line">
            <input type="checkbox" name="mirrored-model-checkbox" />
            <span>@{HomeFurniturePanel.mirroredModelCheckBox.text}</span>
          </label>

          <label title="@{HomeFurniturePanel.basePlanItemCheckBox.tooltip}" class="whole-line">
            <input type="checkbox" name="base-plan-item-checkbox" />
            <span>@{HomeFurniturePanel.basePlanItemCheckBox.text}</span>
          </label>
        </div>

        <br />
        <h3 class="card">@{HomeFurniturePanel.colorAndTexturePanel.title}</h3>
        <div data-name="paint-panel" class="card label-input-grid">
          <div>
            <label>
              <input type="radio" name="paint-checkbox" value="default">
              @{HomeFurniturePanel.defaultColorAndTextureRadioButton.text}
            </label>
          </div>
          <div></div>

          <div>
            <label>
              <input type="radio" name="paint-checkbox" value="color">
              @{HomeFurniturePanel.colorRadioButton.text}
            </label>
          </div>
          <div data-name="color-button"></div>

          <div>
            <label>
              <input type="radio" name="paint-checkbox" value="texture">
              @{HomeFurniturePanel.textureRadioButton.text}
            </label>
          </div>
          <div data-name="texture-component"></div>

          <div>
            <label>
              <input type="radio" name="paint-checkbox" value="MODEL_MATERIALS">
              @{HomeFurniturePanel.modelMaterialsRadioButton.text}
            </label>
          </div>
          <div data-name="material-component"></div>
        </div>
      </div>
      
      <div class="orientation-column">
        <h3 class="card">@{HomeFurniturePanel.orientationPanel.title}</h3>
        <div data-name="orientation-panel" class="card label-input-grid">
          <div class="whole-line" data-name="vertical-rotation-label">@{HomeFurniturePanel.verticalRotationLabel.text}</div>

          <div class="label-cell" data-name="angle-label">@{HomeFurniturePanel.angleLabel.text}</div>
          <div>
            <span data-name="angle-input"></span>
          </div>

          <div class="whole-line"  data-name="horizontal-rotation-label">@{HomeFurniturePanel.horizontalRotationLabel.text}</div>

          <label class="label-cell">
            <input type="radio" name="horizontal-rotation-radio" value="PITCH" />
            @{HomeFurniturePanel.pitchRadioButton.text}
          </label>
          <div>
            <span data-name="pitch-input"></span>
          </div>

          <label class="label-cell">
            <input type="radio" name="horizontal-rotation-radio" value="ROLL" />
            @{HomeFurniturePanel.rollRadioButton.text}
          </label>
          <div>
            <span data-name="roll-input"></span>
          </div>

          <div class="whole-line" data-name="furniture-orientation-image">
          </div>
        </div>
      </div>
      
      <div>
        <h3 class="card">@{HomeFurniturePanel.sizePanel.title}</h3>
        <div data-name="size-panel" class="card label-input-grid">
          <div data-name="width-label" class="label-cell"></div>
          <div>
            <span data-name="width-input"></span>
          </div>
          
          <div data-name="depth-label" class="label-cell"></div>
          <div>
            <span data-name="depth-input"></span>
          </div>
          
          <div data-name="height-label" class="label-cell"></div>
          <div>
            <span data-name="height-input"></span>
          </div>

          <label class="whole-line">
            <input type="checkbox" name="keep-proportions-checkbox" />
            <span>@{ImportedFurnitureWizardStepsPanel.keepProportionsCheckBox.text}</span>
          </label>
          
          <div class="whole-line" style="text-align: center">
            <button name="model-transformations-button">@{HomeFurniturePanel.modelTransformationsButton.text}</button>
          </div>
        </div>
        
        <br />
        <h3 class="card">@{HomeFurniturePanel.shininessPanel.title}</h3>
        <div data-name="shininess-panel" class="card label-input-grid">
          <div>
            <label>
              <input name="shininess-radio" type="radio" value="DEFAULT" />
              <span>@{HomeFurniturePanel.defaultShininessRadioButton.text}</span>
            </label>
          </div>

          <div>
            <label>
              <input name="shininess-radio" type="radio" value="MATT" />
              <span>@{HomeFurniturePanel.mattRadioButton.text}</span>
            </label>
          </div>

          <div>
            <label>
              <input name="shininess-radio" type="radio" value="SHINY" />
              <span>@{HomeFurniturePanel.shinyRadioButton.text}</span>
            </label>
          </div>
        </div>
      </div>
    </div>

    <br />
    <div class="card visibility">
      <label>
        <input type="checkbox" name="visible-checkbox" />
        <span>@{HomeFurniturePanel.visibleCheckBox.text}</span>
      </label>
    </div>
  </div>
</div>


<div id="observer-camera-dialog-template" class="dialog-template">
  <div class="observer-camera-dialog">
    <div class="columns">
      <div>
        <h3 class="card">@{ObserverCameraPanel.locationPanel.title}</h3>
        <div data-name="location-panel" class="card label-input-grid">
          <div data-name="x-label" class="label-cell"></div>
          <div>
            <span data-name="x-input"></span>
          </div>

          <div data-name="y-label" class="label-cell"></div>
          <div>
            <span data-name="y-input"></span>
          </div>

          <div data-name="elevation-label" class="label-cell"></div>
          <div>
            <span data-name="elevation-input"></span>
          </div>
        </div>
      </div>

      <div>
        <h3 class="card">@{ObserverCameraPanel.anglesPanel.title}</h3>
        <div data-name="angles-panel" class="card label-input-grid">

          <div class="label-cell">@{ObserverCameraPanel.yawLabel.text}</div>
          <div>
            <span data-name="yaw-input"></span>
          </div>

          <div class="label-cell">@{ObserverCameraPanel.pitchLabel.text}</div>
          <div>
            <span data-name="pitch-input"></span>
          </div>

          <div class="label-cell">@{ObserverCameraPanel.fieldOfViewLabel.text}</div>
          <div>
            <span data-name="field-of-view-input"></span>
          </div>
        </div>
      </div>
    </div>

    <br />
    <label>
      <input type="checkbox" name="adjust-observer-camera-elevation-checkbox" />
      @{ObserverCameraPanel.adjustObserverCameraElevationCheckBox.text}
    </label>
  </div>
</div>

<div id="home-3Dattributes-dialog-template" class="dialog-template">
  <div class="home-3Dattributes-dialog">
    <div class="columns">
      <div class="column1">
        <h3 class="card">@{Home3DAttributesPanel.groundPanel.title}</h3>
        <div class="card label-input-grid">
          <div>
            <label>
              <input type="radio" name="ground-color-and-texture-choice" value="COLORED">
              @{Home3DAttributesPanel.groundColorRadioButton.text}
            </label>
          </div>
          <div data-name="ground-color-button"></div>

          <div>
            <label>
              <input type="radio" name="ground-color-and-texture-choice" value="TEXTURED">
              @{Home3DAttributesPanel.groundTextureRadioButton.text}
            </label>
          </div>
          <div data-name="ground-texture-component"></div>

          <div class="whole-line">
            <label>
              <input type="checkbox" name="background-image-visible-on-ground-3D-checkbox" />
              @{Home3DAttributesPanel.backgroundImageVisibleOnGround3DCheckBox.text}
            </label>
          </div>
        </div>
      </div>
      <div class="column2">
        <h3 class="card">@{Home3DAttributesPanel.skyPanel.title}</h3>
        <div class="card label-input-grid">
          <div>
            <label>
              <input type="radio" name="sky-color-and-texture-choice" value="COLORED">
              @{Home3DAttributesPanel.skyColorRadioButton.text}
            </label>
          </div>
          <div data-name="sky-color-button"></div>

          <div>
            <label>
              <input type="radio" name="sky-color-and-texture-choice" value="TEXTURED">
              @{Home3DAttributesPanel.skyTextureRadioButton.text}
            </label>
          </div>
          <div data-name="sky-texture-component"></div>
        </div>
      </div>
    </div>

    <br />
    <h3 class="card">@{Home3DAttributesPanel.renderingPanel.title}</h3>
    <div class="card label-input-grid">
      <div>
        @{Home3DAttributesPanel.brightnessLabel.text}
      </div>
      <div>
        <input type="range" name="brightness-slider" min="0" max="255" list="home-3Dattributes-brightness-list" />
        <datalist id="home-3Dattributes-brightness-list"></datalist>
        <div class="slider-labels">
          <div>@{Home3DAttributesPanel.darkLabel.text}</div>
          <div>@{Home3DAttributesPanel.brightLabel.text}</div>
        </div>
      </div>

      <div>
        @{Home3DAttributesPanel.wallsTransparencyLabel.text}
      </div>
      <div>
        <input type="range" name="walls-transparency-slider" min="0" max="255" list="home-3Dattributes-walls-transparency-list" />
        <datalist id="home-3Dattributes-walls-transparency-list"></datalist>
        <div class="slider-labels">
          <div>@{Home3DAttributesPanel.opaqueLabel.text}</div>
          <div>@{Home3DAttributesPanel.invisibleLabel.text}</div>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="compass-dialog-template" class="dialog-template">
  <div class="compass-dialog">
    <h3 class="card">@{CompassPanel.compassRosePanel.title}</h3>
    <div class="card label-input-grid double">
      <span data-name="x-label" class="label-cell"></span>
      <span data-name="x-input"></span>

      <label class="label-and-input">
        <input type="checkbox" name="visible-checkbox" />
        <span>@{CompassPanel.visibleCheckBox.text}</span>
      </label>

      <span data-name="y-label" class="label-cell"></span>
      <span data-name="y-input"></span>

      <span data-name="diameter-label" class="label-cell"></span>
      <span data-name="diameter-input"></span>
    </div>
    
    <br />
    <h3 class="card">@{CompassPanel.geographicLocationPanel.title}</h3>
    <div class="card label-input-grid double">
      <span class="label-cell">@{CompassPanel.latitudeLabel.text}</span>
      <span data-name="latitude-input"></span>

      <span class="label-cell">@{CompassPanel.northDirectionLabel.text}</span>
      <span>
        <span data-name="north-direction-input"></span>
        <canvas data-name="compass-preview">
        </canvas>
      </span>

      <span class="label-cell">@{CompassPanel.longitudeLabel.text}</span>
      <span data-name="longitude-input"></span>
    </div>
  </div>
</div>

<div id="level-dialog-template" class="dialog-template">
  <div class="level-dialog">
    <div class="label-input-grid">
      <span></span>
      <label>
        <input type="checkbox" name="viewable-checkbox" />
        <span>@{LevelPanel.viewableCheckBox.text}</span>
      </label>

      <span class="label-cell">@{LevelPanel.nameLabel.text}</span>
      <span><input name="name-input" type="text" /></span>

      <span data-name="elevation-label" class="label-cell"></span>
      <span>
        <span data-name="elevation-input"></span>
      </span>

      <span data-name="floor-thickness-label" class="label-cell"></span>
      <span>
        <span data-name="floor-thickness-input"></span>
      </span>

      <span data-name="height-label" class="label-cell"></span>
      <span>
        <span data-name="height-input"></span>
      </span>
    </div>

    <hr />
    <div>@{LevelPanel.levelsSummaryLabel.text}</div>
    <br/>
    <div class="levels-summary">
      <table data-name="levels-table">
        <thead>
          <tr>
            <th>@{LevelPanel.nameColumn}</th>
            <th>@{LevelPanel.elevationColumn}</th>
            <th>@{LevelPanel.floorThicknessColumn}</th>
            <th>@{LevelPanel.heightColumn}</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
      <div class="levels-elevation-index-buttons">
        <button name="increase-elevation-index-button"></button>
        <br/>
        <button name="decrease-elevation-index-button"></button>
      </div>
    </div>
  </div>
</div>

<div id="wall-dialog-template" class="dialog-template">
  <div class="wall-dialog">
    <h3 class="card">@{WallPanel.startPointPanel.title}</h3>
    <div class="card label-input-grid double">
      <span data-name="x-start-label"></span>
      <span data-name="x-start-input"></span>
      <span data-name="y-start-label"></span>
      <span data-name="y-start-input"></span>
    </div>

    <br />
    <h3 class="card">@{WallPanel.endPointPanel.title}</h3>
    <div class="card label-input-grid double">
      <span data-name="x-end-label"></span>
      <span data-name="x-end-input"></span>
      <span data-name="y-end-label"></span>
      <span data-name="y-end-input"></span>
      <span class="whole-line">
        <span data-name="distance-to-end-point-label"></span>
        <span data-name="distance-to-end-point-input"></span>
      </span>
    </div>

    <br />
    <div class="columns-2">
      <div class="column1">
        <h3 class="card">@{WallPanel.leftSidePanel.title}</h3>
        <div class="color-and-texture-panel card label-input-grid">
          <div>
            <label>
              <input type="radio" name="left-side-color-and-texture-choice" value="COLORED">
              @{WallPanel.leftSideColorRadioButton.text}
            </label>
          </div>
          <div data-name="left-side-color-button"></div>
          
          <div>
            <label>
              <input type="radio" name="left-side-color-and-texture-choice" value="TEXTURED">
              @{WallPanel.leftSideTextureRadioButton.text}
            </label>
          </div>
          <div data-name="left-side-texture-component"></div>

          <div class="whole-line">
            <hr />
          </div>

          <label>
            <input type="radio" name="left-side-shininess-choice" value="0">
            @{WallPanel.leftSideMattRadioButton.text}
          </label>
          <label>
            <input type="radio" name="left-side-shininess-choice" value="0.25">
            @{WallPanel.leftSideShinyRadioButton.text}
          </label>

          <div class="whole-line" style="text-align: center">
            <button name="left-side-modify-baseboard-button"></button>
          </div>
        </div>
      </div>
      
      <div class="column2">
        <h3 class="card">@{WallPanel.rightSidePanel.title}</h3>
        <div class="color-and-texture-panel card label-input-grid">
          <div>
            <label>
              <input type="radio" name="right-side-color-and-texture-choice" value="COLORED">
              @{WallPanel.rightSideColorRadioButton.text}
            </label>
          </div>
          <div data-name="right-side-color-button"></div>
          
          <div>
            <label>
              <input type="radio" name="right-side-color-and-texture-choice" value="TEXTURED">
              @{WallPanel.rightSideTextureRadioButton.text}
            </label>
          </div>         
          <div data-name="right-side-texture-component"></div>

          <div class="whole-line">
            <hr />
          </div>

          <label>
            <input type="radio" name="right-side-shininess-choice" value="0">
            @{WallPanel.rightSideMattRadioButton.text}
          </label>
          <label>
            <input type="radio" name="right-side-shininess-choice" value="0.25">
            @{WallPanel.rightSideShinyRadioButton.text}
          </label>

          <div class="whole-line" style="text-align: center">
            <button name="right-side-modify-baseboard-button"></button>
          </div>
        </div>
      </div>
    </div>

    <br />
    <h3 class="card">@{WallPanel.topPanel.title}</h3>
    <div class="card label-input-grid">
      <span>@{WallPanel.patternLabel.text}</span>
      <div data-name="pattern-select"></div>

      <span>@{WallPanel.topColorLabel.text}</span>
      <span>
        <label>
          <input type="radio" name="top-color-choice" value="DEFAULT">
          @{WallPanel.topDefaultColorRadioButton.text}
        </label>
        <label>
          <input type="radio" name="top-color-choice" value="COLORED">
          @{WallPanel.topColorRadioButton.text}
          <span data-name="top-color-button"></span>
        </label>
      </span>
    </div>

    <br />
    <h3 class="card">@{WallPanel.heightPanel.title}</h3>
    <div class="card">
      <div class="columns-2">
        <div class="column1">

          <div>
            <label>
              <input type="radio" name="wall-shape-choice" value="RECTANGULAR_WALL">
              @{WallPanel.rectangularWallRadioButton.text}
            </label>
          </div>
          <br />

          <div class="label-input-grid">
            <span data-name="rectangular-wall-height-label" class="label-cell"></span>
            <span data-name="rectangular-wall-height-input"></span>
          </div>
        </div>

        <div class="column2">
          <div>
            <label class="label-and-input">
              <input type="radio" name="wall-shape-choice" value="SLOPING_WALL">
              @{WallPanel.slopingWallRadioButton.text}
            </label>
          </div>
          <br />

          <div class="label-input-grid">
            <span class="label-cell">@{WallPanel.slopingWallHeightAtStartLabel.text}</span>
            <span data-name="sloping-wall-height-at-start-input"></span>
            <span class="label-cell">@{WallPanel.slopingWallHeightAtEndLabel.text}</span>
            <span data-name="sloping-wall-height-at-end-input"></span>
          </div>
        </div>
      </div>
    </div>

    <br />
    <div class="card label-input-grid double">
      <span data-name="thickness-label" class="label-cell"></span>
      <span data-name="thickness-input"></span>
      <span data-name="arc-extent-label" class="label-cell"></span>
      <span data-name="arc-extent-input"></span>
    </div>
    
    <br/>
    <div data-name="wall-orientation-label" class="card">
    </div>
  </div>
</div>

<div id="room-dialog-template" class="dialog-template">
  <div class="room-dialog">
    <h3 class=card>@{RoomPanel.nameAndAreaPanel.title}</h3>
    <div data-name="name-and-area-panel" class=card>
      <span>
        @{RoomPanel.nameLabel.text}
        <input name="name-input" type="text" />
      </span>

      <label>
        <input type="checkbox" name="area-visible-checkbox" />
        @{RoomPanel.areaVisibleCheckBox.text}
      </label>
    </div>

    <div class="columns">
      <div>
        <h3 class=card>@{RoomPanel.floorPanel.title}</h3>
        <div data-name="floor-panel" class="card label-input-grid">

          <div class="whole-line">
            <label>
              <input type="checkbox" name="floor-visible-checkbox" />
              @{RoomPanel.floorVisibleCheckBox.text}
            </label>
          </div>

          <div>
            <label>
              <input type="radio" name="floor-color-and-texture-choice" value="COLORED">
              @{RoomPanel.floorColorRadioButton.text}
            </label>
          </div>
          <div data-name="floor-color-button"></div>

          <div>
            <label>
              <input type="radio" name="floor-color-and-texture-choice" value="TEXTURED">
              @{RoomPanel.floorTextureRadioButton.text}
            </label>
          </div>
          <div data-name="floor-texture-component"></div>
    
          <div class="whole-line">
            <label>&nbsp;</label>
          </div>

          <div class="whole-line">
            <hr />
          </div>

          <div class="whole-line">
            <label>
              <input type="radio" name="floor-shininess-choice" value="0">
              @{RoomPanel.floorMattRadioButton.text}
            </label>
            <label>
              <input type="radio" name="floor-shininess-choice" value="0.25">
              @{RoomPanel.floorShinyRadioButton.text}
            </label>
          </div>
        </div>
      </div>

      <div>
        <h3 class=card>@{RoomPanel.ceilingPanel.title}</h3>
        <div data-name="ceiling-panel" class="card label-input-grid">

          <div class="whole-line">
            <label>
              <input type="checkbox" name="ceiling-visible-checkbox" />
              @{RoomPanel.ceilingVisibleCheckBox.text}
            </label>
          </div>

          <div>
            <label>
              <input type="radio" name="ceiling-color-and-texture-choice" value="COLORED">
              @{RoomPanel.ceilingColorRadioButton.text}
            </label>
          </div>
          <div data-name="ceiling-color-button"></div>

          <div>
            <label>
              <input type="radio" name="ceiling-color-and-texture-choice" value="TEXTURED">
              @{RoomPanel.ceilingTextureRadioButton.text}
            </label>
          </div>
          <div data-name="ceiling-texture-component"></div>

          <div class="whole-line">
            <label>
              <input type="checkbox" name="ceiling-flat-checkbox" />
              @{RoomPanel.ceilingFlatCheckBox.text}
            </label>
          </div>

          <div class="whole-line">
            <hr />
          </div>

          <div class="whole-line">
            <label>
              <input type="radio" name="ceiling-shininess-choice" value="0">
              @{RoomPanel.ceilingMattRadioButton.text}
            </label>
            <label>
              <input type="radio" name="ceiling-shininess-choice" value="0.25">
              @{RoomPanel.ceilingShinyRadioButton.text}
            </label>
          </div>

        </div>
      </div>

      <div>
        <h3 class="card">@{RoomPanel.wallSidesPanel.title}</h3>
        <div data-name="wall-sides-panel" class="card label-input-grid">

          <div class="whole-line">
            <label title="@{RoomPanel.splitSurroundingWallsCheckBox.tooltip}">
              <input type="checkbox" name="split-surrounding-walls-checkbox" />
              @{RoomPanel.splitSurroundingWallsCheckBox.text}
            </label>
          </div>

          <div>
            <label>
              <input type="radio" name="wall-sides-color-and-texture-choice" value="COLORED">
              @{RoomPanel.wallSidesColorRadioButton.text}
            </label>
          </div>
          <div data-name="wall-sides-color-button"></div>
          <div>
            <label>
              <input type="radio" name="wall-sides-color-and-texture-choice" value="TEXTURED">
              @{RoomPanel.wallSidesTextureRadioButton.text}
            </label>
          </div>
          <div data-name="wall-sides-texture-component"></div>

          <div class="whole-line">
            <label>&nbsp;</label>
          </div>
          
          <div class="whole-line">
            <hr />
          </div>

          <div class="whole-line">
            <label>
              <input type="radio" name="wall-sides-shininess-choice" value="0">
              @{RoomPanel.wallSidesMattRadioButton.text}
            </label>
            <label>
              <input type="radio" name="wall-sides-shininess-choice" value="0.25">
              @{RoomPanel.wallSidesShinyRadioButton.text}
            </label>
          </div>
        </div>
      </div>

      <div>
          <h3 class="card">@{RoomPanel.wallSidesBaseboardPanel.title}</h3>
          <div data-name="wall-sides-baseboard-panel" class="card">

          </div>
      </div>
    </div>
  </div>
</div>

<div id="user-preferences-dialog-template" class="dialog-template">  
  <div class="user-preferences-dialog label-input-grid">
    <div>@{UserPreferencesPanel.languageLabel.text}</div>
    <div>
      <select name="language-select"></select>
    </div>

    <div>@{UserPreferencesPanel.unitLabel.text}</div>
    <div>
      <select name="unit-select"></select>
    </div>
    
    <div>@{UserPreferencesPanel.currencyLabel.text}</div>
    <div>
      <select name="currency-select"></select>

      <label>
        <input type="checkbox" name="value-added-tax-checkbox" />
        @{UserPreferencesPanel.valueAddedTaxCheckBox.text}
      </label>
    </div>
    
    <div>@{UserPreferencesPanel.furnitureCatalogViewLabel.text}</div>
    <div>
      <label>
        <input type="radio" name="furniture-catalog-view-radio" value="tree" />
        @{UserPreferencesPanel.treeRadioButton.text}
      </label>
      <label>
        <input type="radio" name="furniture-catalog-view-radio" value="list" />
        @{UserPreferencesPanel.listRadioButton.text}
      </label>
    </div>

    <div>@{UserPreferencesPanel.navigationPanelLabel.text}</div>
    <div>
      <label>
        <input type="checkbox" name="navigation-panel-checkbox" />
        @{UserPreferencesPanel.navigationPanelCheckBox.text}
      </label>
    </div>
    
    <div>@{UserPreferencesPanel.editingIn3DViewLabel.text}</div>
    <div>
      <label>
        <input type="checkbox" name="editing-in-3D-view-checkbox" />
        @{UserPreferencesPanel.editingIn3DViewCheckBox.text}
      </label>
    </div>
    
    <div>@{UserPreferencesPanel.aerialViewCenteredOnSelectionLabel.text}</div>
    <div>
      <label>
        <input type="checkbox" name="aerial-view-centered-on-selection-checkbox" />
        @{UserPreferencesPanel.aerialViewCenteredOnSelectionCheckBox.text}
      </label>
    </div>

    <div>@{UserPreferencesPanel.observerCameraSelectedAtChangeLabel.text}</div>
    <div>
      <label>
        <input type="checkbox" name="observer-camera-selected-at-change-checkbox" />
        @{UserPreferencesPanel.observerCameraSelectedAtChangeCheckBox.text}
      </label>
    </div>

    <div>@{UserPreferencesPanel.magnetismLabel.text}</div>
    <div>
      <label>
        <input type="checkbox" name="magnetism-checkbox" />
        @{UserPreferencesPanel.magnetismCheckBox.text}
      </label>
    </div>

    <div>@{UserPreferencesPanel.rulersLabel.text}</div>
    <div>
      <label>
        <input type="checkbox" name="rulers-checkbox" />
        @{UserPreferencesPanel.rulersCheckBox.text}
      </label>
    </div>

    <div>@{UserPreferencesPanel.gridLabel.text}</div>
    <div>
      <label>
        <input type="checkbox" name="grid-checkbox" />
        @{UserPreferencesPanel.gridCheckBox.text}
      </label>
    </div>

    <div>@{UserPreferencesPanel.defaultFontNameLabel.text}</div>
    <div>
      <select name="default-font-name-select">
      </select>
    </div>

    <div>@{UserPreferencesPanel.furnitureIconLabel.text}</div>
    <div>
      <label>
        <input type="radio" name="furniture-icon-radio" value="catalog" />
        @{UserPreferencesPanel.catalogIconRadioButton.text}
      </label>
      <br />
      <label>
        <input type="radio" name="furniture-icon-radio" value="topView" />
        @{UserPreferencesPanel.topViewRadioButton.text}
      </label>
      @{UserPreferencesPanel.iconSizeLabel.text}
      <select name="icon-size-select"></select>
    </div>

    <div>@{UserPreferencesPanel.roomRenderingLabel.text}</div>
    <div>
      <label>
        <input type="radio" name="room-rendering-radio" value="monochrome" />
        @{UserPreferencesPanel.monochromeRadioButton.text}
      </label>
      <label>
        <input type="radio" name="room-rendering-radio" value="floorColorOrTexture" />
        @{UserPreferencesPanel.floorColorOrTextureRadioButton.text}
      </label>
    </div>

    <div>@{UserPreferencesPanel.newWallPatternLabel.text}</div>
    <div data-name="new-wall-pattern-select"></div>

    <div>@{UserPreferencesPanel.newWallThicknessLabel.text}</div>
    <div>
      <span data-name="new-wall-thickness-input"></span>
    </div>
    <div>@{UserPreferencesPanel.newWallHeightLabel.text}</div>
    <div>
      <span data-name="new-wall-height-input"></span>
    </div>
    <div>@{UserPreferencesPanel.newFloorThicknessLabel.text}</div>
    <div>
      <span data-name="new-floor-thickness-input"></span>
    </div>
  </div>
</div>

<div id="polyline-dialog-template" class="dialog-template">
  <div class="polyline-dialog label-input-grid">
    <div data-name="thickness-label">
    </div>
    <div>
      <span data-name="thickness-input"></span>
    </div>

    <div>
      @{PolylinePanel.arrowsStyleLabel.text}
    </div>
    <div data-name="arrows-style-select"></div>

    <div>
      @{PolylinePanel.joinStyleLabel.text}
    </div>
    <div data-name="join-style-select"></div>

    <div>
      @{PolylinePanel.dashStyleLabel.text}
    </div>
    <div data-name="dash-style-select"></div>

    <div>
      @{PolylinePanel.dashOffsetLabel.text}
    </div>
    <div>
      <span data-name="dash-offset-input"></span>
    </div>

    <div>
      @{PolylinePanel.colorLabel.text}
    </div>
    <div data-name="color-button"></div>
    
    <div></div>
    <div>
      <label>
        <input type="checkbox" name="visible-in-3D-checkbox" />
        @{PolylinePanel.visibleIn3DViewCheckBox.text}
      </label>
    </div>
    <div></div>
  </div>
</div>

<div id="dimension-line-dialog-template" class="dialog-template">
  <div class="dimension-line-dialog">
    <h3 class="card">@{DimensionLinePanel.startPointPanel.title}</h3>
    <div class="card label-input-grid double">
      <span data-name="x-start-label"></span>
      <span data-name="x-start-input"></span>
      <span data-name="y-start-label"></span>
      <span data-name="y-start-input"></span>
      <span data-name="elevation-start-label"></span>
      <span data-name="elevation-start-input"></span>
    </div>

    <br />
    <h3 class="card">@{DimensionLinePanel.endPointPanel.title}</h3>
    <div class="card label-input-grid double">
      <span data-name="x-end-label"></span>
      <span data-name="x-end-input"></span>
      <span data-name="y-end-label"></span>
      <span data-name="y-end-input"></span>
      <span class="whole-line end-point-addition">
        <span data-name="distance-to-end-point-label"></span>
        <span data-name="distance-to-end-point-input"></span>
      </span>
      <span class="whole-line end-point-addition">
        <span data-name="offset-label"></span>
        <span data-name="offset-input"></span>
      </span>
      <div class="whole-line">
        <hr />
      </div>
      <span class="whole-line orientation">
        <label>
          <input type="radio" name="orientation-choice" value="PLAN">
          @{DimensionLinePanel.planDimensionLineRadioButton.text}
        </label>
        <label>
          <input type="radio" name="orientation-choice" value="ELEVATION">
          @{DimensionLinePanel.elevationDimensionLineRadioButton.text}
         </label>
      </span>
    </div>
    
    <br />
    <h3 class=card>@{DimensionLinePanel.stylePanel.title}</h3>
    <div data-name="style-panel" class="card label-input-grid">
      <div data-name="length-font-size-label">
      </div>
      <div data-name="length-font-size-input-container">
        <span data-name="length-font-size-input"></span>
      </div>

      <div data-name="color-label">
        @{DimensionLinePanel.colorLabel.text}
      </div>
      <div data-name="color-button"></div>
    </div>

    <br />
    <h3 class=card>@{DimensionLinePanel.rendering3DPanel.title}</h3>
    <div data-name="rendering-3D-panel" class="card label-input-grid">
      <div class="whole-line">
        <label>
          <input type="checkbox" name="visible-in-3D-checkbox" />
          @{DimensionLinePanel.visibleIn3DViewCheckBox.text}
        </label>
      </div>

      <div>
        @{DimensionLinePanel.pitchLabel.text}
      </div>
      <div>
        <label>
          <input type="radio" name="label-pitch-radio" value="0" />
          @{DimensionLinePanel.pitch0DegreeRadioButton.text}
        </label>
        <label>
          <input type="radio" name="label-pitch-radio" value="90" />
          @{DimensionLinePanel.pitch90DegreeRadioButton.text}
        </label>
      </div>
    </div>
  </div>
</div>

<div id="label-dialog-template" class="dialog-template">
  <div class="label-dialog">
    <h3 class=card>@{LabelPanel.textAndStylePanel.title}</h3>
    <div data-name="text-and-style-panel" class="card label-input-grid">
      <div>
        @{LabelPanel.textLabel.text}
      </div>
      <div>
        <textarea name="text" rows="4"></textarea>
      </div>

      <div>
        @{LabelPanel.alignmentLabel.text}
      </div>
      <div>
        <label>
          <input type="radio" name="label-alignment-radio" value="LEFT" />
          @{LabelPanel.leftAlignmentRadioButton.text}
        </label>
        <label>
          <input type="radio" name="label-alignment-radio" value="CENTER" />
          @{LabelPanel.centerAlignmentRadioButton.text}
        </label>
        <label>
          <input type="radio" name="label-alignment-radio" value="RIGHT" />
          @{LabelPanel.rightAlignmentRadioButton.text}
        </label>
      </div>

      <div>
        @{LabelPanel.fontNameLabel.text}
      </div>
      <div>
        <select name="font-select">
        </select>
      </div>

      <div data-name="font-size-label">
      </div>
      <div data-name="font-size-input-container">
        <span data-name="font-size-input"></span>
      </div>

      <div data-name="color-label">
        @{LabelPanel.colorLabel.text}
      </div>
      <div data-name="color-button"></div>
    </div>

    <br />
    <h3 class=card>@{LabelPanel.rendering3DPanel.title}</h3>
    <div data-name="rendering-3D-panel" class="card label-input-grid">
      <div class="whole-line">
        <label>
          <input type="checkbox" name="visible-in-3D-checkbox" />
          @{LabelPanel.visibleIn3DViewCheckBox.text}
        </label>
      </div>

      <div>
        @{LabelPanel.pitchLabel.text}
      </div>
      <div>
        <label>
          <input type="radio" name="label-pitch-radio" value="0" />
          @{LabelPanel.pitch0DegreeRadioButton.text}
        </label>
        <label>
          <input type="radio" name="label-pitch-radio" value="90" />
          @{LabelPanel.pitch90DegreeRadioButton.text}
        </label>
      </div>

      <div data-name="elevation-label">
      </div>
      <div>
        <span data-name="elevation-input"></span>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
// If set to not null value, requires the server to be properly started on localhost:8080 with a ROOT path 
// and this page being accessed from localhost:8080 too (using a module path pointing on project for example)
var urlBase = 'http://localhost:8080';
var useServer = false;
var skipTests = window.location.search.indexOf("skipTests=true") >= 0;

var application = useServer
    ? new SweetHome3DJSApplication(
          {readHomeURL:                 urlBase + "/readHome.jsp?home=%s",
           writeHomeEditsURL:           urlBase + "/writeHomeEdits.jsp",
           closeHomeURL:                urlBase + "/closeHome.jsp?home=%s",
           pingURL:                     urlBase + "/ping.jsp",
           writeResourceURL:            urlBase + "/writeResource.jsp?path=%s",
           readResourceURL:             urlBase + "/userResources/%s",
           writePreferencesURL:         urlBase + "/writeResource.jsp?path=userPreferences.json",
           readPreferencesURL:          urlBase + "/userResources/userPreferences.json",
           autoWriteDelay:              1000,
           autoWriteTrackedStateChange: true,
           writingObserver: {
               writeStarted: function(update) {
                 console.info("Update started", update);
               },
               writeSucceeded: function(update) {
                 console.info("Update succeeded", update);
               },
               writeFailed: function(update, errorStatus, errorText) {
                 console.info("Update failed", update);
               },
               connectionFound: function() {
                 console.info("Back to online mode");
               },
               connectionLost: function(errorStatus, errorText) {
                 console.info("Lost server connection - going offline");
               }
             }
          })
    : new SweetHome3DJSApplication(
          {furnitureCatalogURLs:     [ZIPTools.getScriptFolder() + "resources/DefaultFurnitureCatalog.json"],
           furnitureResourcesURLBase: ZIPTools.getScriptFolder() + "../",
           texturesCatalogURLs:      [ZIPTools.getScriptFolder() + "resources/DefaultTexturesCatalog.json"],
           texturesResourcesURLBase:  ZIPTools.getScriptFolder() + "../",
           includeAllContent: true,
           compressionLevel: 0,
           writeHomeWithWorker: true,
           autoRecovery: skipTests
          });
var homeName = useServer ? "HomeTest" : window.location.href.substring(0, window.location.href.lastIndexOf('/')) + "/resources/HomeTest.sh3d";

// Read and display test file 
// TODO Should be performed in HomeController.open
application.getHomeRecorder().readHome(homeName, 
    {
      homeLoaded: function(home) {
        home.setName(homeName);
        application.addHome(home);
        
        if (!skipTests) {
          setTimeout(testHomeModifications, 1000);
        }
      },
      homeError: function(err) {
        console.error(err);
        alert(err);
      },
      progression: function(part, info, percentage) {
      }
    });
    
</script>

</body>
</html>
